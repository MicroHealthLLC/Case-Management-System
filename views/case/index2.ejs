<% include ../partials/header2 %>


<div id="topbar">
	<h1>Case</h1>
	<div id="topcasepersoninfo">
     <% if (thiscaseperson.length === 1) { %>
		<p><strong><a href="/person/<%= thiscaseperson[0].person_id %>"><%= thiscaseperson[0].person_name %></a></strong></p>
		<p>Gender: <%= thiscaseperson[0].gender %> &nbsp;&nbsp; DOB: <%= thiscaseperson[0].birthdate %></p>
    <% } else if (thiscaseperson.length > 1) { %>
		<p><strong>Multiple Case Persons</strong></p>
    <% } else { %>
    <br>
    <% } %>
	</div>
</div><!-- topbar -->

<form id="caseform" action="/case/<%= thiscase.case_id %>?_method=PUT" method="post">
<fieldset id="ablecaseform" disabled="disabled">
	<div class="row">
		<div class="col-xs-12">
			<div class="form-group">
				<label for="casetitle">Title</label>
				<input type="text" class="form-control requiredfield" id="casetitle" name="casetitle" size="90" maxlength="150" value=""/>
			</div>
		</div>
	</div><!-- row -->
	<div class="row">
		<div class="col-xs-12">
			<div class="form-group">
				<label for="casedescription">Description</label>
				<textarea class="form-control" id="casedescription" name="casedescription"></textarea>
			</div>
		</div>
	</div><!-- row -->
	<div class="row">
		<div class="col-xs-6 col-sm-4">
			<div class="form-group">
				<label for="casedomain">Domain</label>
				<select class="form-control" id="casedomain" name="casedomain">
					<option value="0">Select</option>
                <% for (var i = 1; i <= caseDomain.length; i += 1) { %>
					<option value="<%= caseDomain[i - 1] %>"><%= caseDomain[i - 1] %></option>
                <% } %>
				</select>
			</div>
		</div>
		<div class="col-xs-6 col-sm-4">
			<div class="form-group">
				<label for="casecategory">Category</label>
				<select class="form-control" id="casecategory" name="casecategory">
					<option value="0">Select</option>
                <% for (var i = 1; i <= caseCategory.length; i += 1) { %>
					<option value="<%= caseCategory[i - 1] %>"><%= caseCategory[i - 1] %></option>
                <% } %>
				</select>
			</div>
		</div>
		<div class="col-xs-6 col-sm-4">
			<div class="form-group">
				<label for="casetype">Type</label>
				<select class="form-control" id="casetype" name="casetype">
					<option value="0">Select</option>
                <% for (var i = 1; i <= caseDomain.length; i += 1) {
                	for (var j = 1; j <= caseCategory.length; j += 1) { %>
					<option class="<%= i %> <%= j %>" value="<%= caseDomain[i - 1] %> and <%= caseCategory[j - 1] %>"><%= caseDomain[i - 1] %> and <%= caseCategory[j - 1] %></option>
				<% } } %>
				</select>
			</div>
		</div>
		<div class="col-xs-6 col-sm-4">
			<div class="form-group">
				<label for="casestatus">Status</label>
				<select class="form-control" id="casestatus" name="casestatus">
					<option value="0">Select</option>
                <% for (var i = 1; i <= caseStatus.length; i += 1) { %>
					<option value="<%= caseStatus[i - 1] %>"><%= caseStatus[i - 1] %></option>
                <% } %>
				</select>
			</div>
		</div>
		<div class="col-xs-6 col-sm-4">
			<div class="form-group">
				<label for="caseseverity">Severity</label>
				<select class="form-control" id="caseseverity" name="caseseverity">
					<option value="0">Select</option>
                <% for (var i = 1; i <= caseSeverity.length; i += 1) { %>
					<option value="<%= caseSeverity[i - 1] %>"><%= caseSeverity[i - 1] %></option>
                <% } %>
				</select>
			</div>
		</div>
		<div class="col-xs-6 col-sm-4">
			<div class="form-group">
				<label for="casepriority">Priority</label>
				<select class="form-control" id="casepriority" name="casepriority">
					<option value="0">Select</option>
                <% for (var i = 1; i <= casePriority.length; i += 1) { %>
					<option value="<%= casePriority[i - 1] %>"><%= casePriority[i - 1] %></option>
                <% } %>
				</select>
			</div>
		</div>
		<div class="col-xs-6 col-sm-4">
			<div class="form-group">
				<label for="casestartdate">Start Date</label>
				<input type="text" class="form-control" id="casestartdate" name="casestartdate" value=""/>
			</div>
		</div>
		<div class="col-xs-6 col-sm-4">
			<div class="form-group">
				<label for="caseduedate">Due Date</label>
				<input type="text" class="form-control" id="caseduedate" name="caseduedate" value=""/>
			</div>
		</div>
		<div class="col-xs-6 col-sm-4">
			<div class="form-group">
				<label for="casecompletedate">Complete Date</label>
				<input type="text" class="form-control" id="casecompletedate" name="casecompletedate" value=""/>
			</div>
		</div>
	</div><!-- row -->
</fieldset>
	<div id="cancelsavecase" class="buttonrow">
		<button type="reset" class="btn btn-warning btn-md mainresetbtn" id="resetcase" name="resetcase">Cancel</button>
		<button type="submit" class="btn btn-warning btn-md mainsubmitbtn" id="submitcase" name="submitcase">Save</button>
	</div>
</form>
	<div id="editdeletecase" class="buttonrow">
		<!-- NOTE: Insert Code for Development/Production -->
		<!-- Input route for id method=DELETE" method="POST" -->
 		<button class="btn btn-primary btn-md maineditbtn" id="editcase"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></button>
        <form class="oneline" action="/case/<%= thiscase.case_id %>?_method=DELETE" method="post">
            <button class="btn btn-danger btn-md maindeletebtn" id="deletecase" name="deletecase"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
        </form>
	</div>

<div id="taskpanel">
	<ul class="nav nav-pills" role="tablist" id="navmenu">
		<li role="presentation" class="active"><a href="#cases_brief" aria-controls="cases_brief" role="tab" data-toggle="pill">Case Brief</a></li>
		<li role="presentation"><a href="#relatedcases" aria-controls="relatedcases" role="tab" data-toggle="pill">Related Cases</a></li>
		<li role="presentation"><a href="#assignedpeople" aria-controls="assignedpeople" role="tab" data-toggle="pill">People</a></li>
		<li role="presentation"><a href="#assignedorganizations" aria-controls="assignedorganizations" role="tab" data-toggle="pill">Organizations</a></li>
		<li role="presentation"><a href="#goals" aria-controls="goals" role="tab" data-toggle="pill">Goals</a></li>
		<li role="presentation"><a href="#plans" aria-controls="plans" role="tab" data-toggle="pill">Plans</a></li>
		<li role="presentation"><a href="#actions" aria-controls="actions" role="tab" data-toggle="pill">Actions</a></li>
		<li role="presentation"><a href="#casefiles" aria-controls="casefiles" role="tab" data-toggle="pill">Files</a></li>
		<li role="presentation"><a href="#casenotes" aria-controls="casenotes" role="tab" data-toggle="pill">Notes</a></li>
		<li role="presentation"><a href="#questionnaires" aria-controls="questionnaires" role="tab" data-toggle="pill">Questionnaires</a></li>
	</ul>
	<div class="tab-content">

	<div role="tabpanel" class="tab-pane active" id="cases_brief">


    <% if (thiscaseperson.length > 0) { %>
		<table id="casepersondisplaytable" class="table table-responsive table-striped table-condensed">
			<thead>
				<tr class="info">
					<th>Case Person Name</th>
                <% if (thiscaseperson.length > 1) { %>
					<th>Gender</th>
					<th>DOB</th>
                <% } %>
					<th>Primary Phone</th>
					<th>Primary Email</th>
				</tr>
			</thead>
			<tbody>
            <% for (var i = 0; i < thiscaseperson.length; i += 1) { %>
				<tr>
					<td><a href="/person/<%= thiscaseperson[i].person_id %>"><%= thiscaseperson[i].person_name %></a></td>
                <% if (thiscaseperson.length > 1) { %>
                    <td><%= thiscaseperson[i].gender %></td>
                    <td><%= thiscaseperson[i].birthdate %></td>
                <% } %>
					<td><%= thiscaseperson[i].primary_phone %></td>
					<td><%= thiscaseperson[i].primary_email %></td>
                </tr>
                <tr>
                <% if (thiscaseperson.length > 1) { %>
                    <td colspan="5">
                <% } else { %>
                    <td colspan="3">
                <% } %>
                <strong>Primary Address</strong><br>
					<% if (thiscaseperson[i].address !== "") { %>
						<%= thiscaseperson[i].address %>, <%= thiscaseperson[i].city %>, <%= thiscaseperson[i].state %> <%= thiscaseperson[i].zipcode %><br>
						<% if (thiscaseperson[i].statecode !== "") { %>
							State Code: <%= thiscaseperson[i].statecode %> &nbsp;&nbsp; 
						<% } %>
						<% if (thiscaseperson[i].countrycode !== "") { %>
							Country Code: <%= thiscaseperson[i].countrycode %></td>
						<% } %>
					<% } %>
				</tr>
            <% } %>
 			</tbody>
		</table>
<br><br><br>
    <% } %>


	 <% var totalcompleteitems = 0;
		var percentcompletecase = 0;
	 %>

		<% this_cases_goals.sort(function(a,b) {
			return (a.goal_id > b.goal_id) ? 1 : ((b.goal_id > a.goal_id) ? -1 : 0);
		}); %>
		<% this_cases_plans.sort(function(a,b) {
			return (a.assocgoal_id - b.assocgoal_id) || (a.plan_id - b.plan_id);
		}); %>
		<% this_cases_actions.sort(function(a,b) {
			return (a.assocplan_id - b.assocplan_id) || (a.action_id - b.action_id);
		}); %>

        <div class="form-group">
           <label for="expandbrief" class="btn btn-sm btn-default">
              <input type="radio" name="showbriefs" id="expandbrief" class="expandtablesbtn" checked> Show Tables
           </label>
           <label for="collapsebrief" class="btn btn-sm btn-default">
              <input type="radio" name="showbriefs" id="collapsebrief" class="collapsetablesbtn"> Hide Tables
           </label>
		</div>

		<% for (var j = 0; j < this_cases_goals.length; j += 1) {
			var headbrieftable = "headbrieftable" + j;
			var briefhead = "briefhead" + j;
			var divbrieftable = "divbrieftable" + j;
			var goalsthruactionstable = "goalsthruactionstable" + j;
			var goalcomplete = "goalcomplete" + j;
		%>

	<h6><button id="<%= headbrieftable %>" class="btn btn-primary btn-md associatedheadbtn"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> 
	<% if (this_cases_goals[j].complete_date !== "") { %>
	<span id="<%= briefhead %>" class="briefhead prog-end">
	<% } else { %>
	<span id="<%= briefhead %>" class="briefhead prog-mid">
	<% } %>
	Goal: <%= this_cases_goals[j].name %></span></h6>

<div id="<%= divbrieftable %>" class="displaybrief_div">
	<table id="<%= goalsthruactionstable %>" class="table table-responsive table-condensed goalsthruactionstable">
		<thead>
			<tr class="info">
				<th>&nbsp;</th>
				<th>Name</th>
				<th>Type</th>
				<th>Priority</th>
				<th>Due Date</th>
				<th>Assigned To</th>
				<th>Complete</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td class="bg-danger">Goal</td>
				<td><a href="#goals" class="brieflink" id="briefgoaldisplayrow<%= this_cases_goals[j].goal_id %>"><%= this_cases_goals[j].name %></a></td>
				<td><%= this_cases_goals[j].type %></td>
				<td><%= this_cases_goals[j].priority %></td>
				<td><%= this_cases_goals[j].due_date %></td>
				<td><%= this_cases_goals[j].assignedperson_id %></td>
				<td id="<%= goalcomplete %>"><span class="prog-end">
					<% if (this_cases_goals[j].complete_date !== "") {
						totalcompleteitems += 1; %>
						&#10004;
					<% } %></span>
				</td>
			</tr>
		<%  for (var k = 0; k < this_cases_plans.length; k += 1) {
				var plancomplete = "plancomplete" + k;
				if (this_cases_goals[j].goal_id === this_cases_plans[k].assocgoal_id) { %>
			<tr>
				<td class="bg-warning">Plan</td>
				<td><a href="#plans" class="brieflink" id="briefplandisplayrow<%= this_cases_plans[k].plan_id %>"><%= this_cases_plans[k].name %></a></td>
				<td><%= this_cases_plans[k].type %></td>
				<td><%= this_cases_plans[k].priority %></td>
				<td><%= this_cases_plans[k].due_date %></td>
				<td><%= this_cases_plans[k].assignedperson_id %></td>
				<td id="<%= plancomplete %>"><span class="prog-end">
					<% if (this_cases_plans[k].complete_date !== "") {
						totalcompleteitems += 1; %>
						&#10004;
					<% } %></span>					
				</td>
			</tr>
		<% for (var m = 0; m < this_cases_actions.length; m += 1) {
				var actioncomplete = "actioncomplete" + m;
				if (this_cases_plans[k].plan_id === this_cases_actions[m].assocplan_id) { %>
			<tr>
				<td class="bg-success">Action</td>
				<td><a href="#actions" class="brieflink" id="briefactiondisplayrow<%= this_cases_actions[m].action_id %>"><%= this_cases_actions[m].name %></a></td>
				<td><%= this_cases_actions[m].type %></td>
				<td><%= this_cases_actions[m].priority %></td>
				<td><%= this_cases_actions[m].due_date %></td>
				<td><%= this_cases_actions[m].assignedperson_id %></td>
				<td id="<%= actioncomplete %>"><span class="prog-end">
					<% if (this_cases_actions[m].complete_date !== "") {
						totalcompleteitems += 1; %>
						&#10004;
					<% } %></span>													
				</td>
			</tr>
			<% } } %>
		<% } } %>
			</tbody>
		</table>
	</div>
	<% } %>
	
<br>

<%  var totalitems = this_cases_goals.length + this_cases_plans.length + this_cases_actions.length;
 	if (totalitems !== 0) {
		var percentcompletecase = ((totalcompleteitems / totalitems) * 100).toFixed(0);
	} else {
		var percentcompletecase = 0;
	}
 %>
 		<div id="percentcompletecasediv">
			<h5><%= percentcompletecase %>&percnt; Complete Case</h5>
		</div>

		</div><!-- tabpanel cases_brief -->


<!-- **************************************************************************************************** -->

	<div role="tabpanel" class="tab-pane" id="relatedcases">

<div class="buttonrow creatediv">
	<p>
	    <a href="/case" class="btn btn-primary btn-md" id="createcasebtn">Create Case</a>
	</p>
</div>

		<h4><button id="plusrelatedcase" class="btn btn-default btn-md plusbtn"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> Related Case</h4>

		<form id="relatedcaseform" class="toggleform" action="/relatedcase" method="post">
			<div class="row">
				<div class="col-sm-6">
					<div class="form-group">
					<label for="relatedcase_id2">Related Case Title</label>
					<select class="form-control requiredfield" id="relatedcase_id2" name="relatedcase_id2">
						<option value="0">Select</option>
                    <% cases.sort(function(a,b) {
                        return (a.case_id > b.case_id) ? 1 : ((b.case_id > a.case_id) ? -1 : 0);
                    }); %>
                    <% for (var i = 0; i < cases.length; i += 1) { %>
						<option value="<%= cases[i].case_id %>"><%= cases[i].case_title %></option>
                    <% } %>
					</select>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="form-group">
						<label for="caserelationshiptype">Relationship Type</label>
						<select class="form-control" id="caserelationshiptype" name="caserelationshiptype">
							<option value="0">Select</option>
						<% for (var i = 1; i <= caseCaseRelationship.length; i += 1) { %>
							<option value="<%= caseCaseRelationship[i - 1] %>"><%= caseCaseRelationship[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
			</div><!-- row -->
			<div class="row">
				<div class="col-sm-6" hidden>
					<label for="relatedcase_id1">Case ID</label>
					<input type="text" class="form-control" id="relatedcase_id1" name="relatedcase_id1" readonly value="<%= thiscase.case_id %>"/>
				</div>
			</div><!-- row -->
			<div class="buttonrow">
				<button type="reset" class="btn btn-warning btn-md resetbtn" id="resetrelatedcase" name="resetrelatedcase">Reset</button>
				<button type="submit" class="btn btn-warning btn-md submitbtn" id="submitrelatedcase" name="submitrelatedcase">Submit</button>
			</div>
		</form>
	
		<% thisrelatedcase.sort(function(a,b) {
			return (a.thisrelatedcase_id > b.thisrelatedcase_id) ? 1 : ((b.thisrelatedcase_id > a.thisrelatedcase_id) ? -1 : 0);
		}); %>
		<% if (thisrelatedcase.length > 0) { %>
		<table id="relatedcasedisplaytable" class="table table-responsive table-striped table-condensed">
			<thead>
				<tr class="info">
					<th>Related Case Title</th>
					<th>Relationship Type</th>
					<th>&nbsp;</th>
				</tr>
			</thead>
			<tbody>
            <% for (var i = 0; i < thisrelatedcase.length; i += 1) {
				var relcase_caseid = "relcase_caseid" + i;
				var relcase_type = "relcase_type" + i;
				var removerelatedcase = "removerelatedcase" + i;
			%>
				<tr>
					<td><span hidden id="<%= relcase_caseid %>"><%= thisrelatedcase[i].case_id2 %></span><a href="/case/<%= thisrelatedcase[i].case_id2 %>"><%= thisrelatedcase[i].case_title %></a></td>
					<td><span id="<%= relcase_type %>"><%= thisrelatedcase[i].lk_case_relationship_type %></span></td>
					<td class="tablebtns" id="<%= thisrelatedcase[i].case_relationship_id %>">
	                    <form action="#" method="post">
	                        <button class="btn btn-warning btn-md tableremovebtn" id="<%= removerelatedcase %>" name="removerelatedcase"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
	                    </form>
					</td>
				</tr>
            <% } %>
			</tbody>
		</table>
        <% } %>

		</div><!-- tabpanel relatedcases -->


<!-- **************************************************************************************************** -->


	<div role="tabpanel" class="tab-pane" id="assignedpeople">

<div class="buttonrow creatediv">
	<p><a href="/person" class="btn btn-primary btn-md" id="createpersonbtn">Create Person</a></p>
</div>
	
    <h4><button id="pluspersonassignment" class="btn btn-default btn-md plusbtn2"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> Person</h4>
	
		<form id="personassignmentform" class="toggleform" action="/personassignment" method="post">
        <fieldset id="ablepersonassignment">
			<div class="row">
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="personassignpersonid">Person Name</label>
						<select class="form-control requiredfield" id="personassignpersonid" name="personassignpersonid">
							<option value="0" selected>Select</option>
							<% for (var i = 0; i < person.length; i += 1) { %>
							<option value="<%= person[i].person_id %>"><%= person[i].last_name %>, <%= person[i].first_name %> <%= person[i].middle_name %></option>
                            <% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="personassignrole">Assigned Role</label>
						<select class="form-control requiredfield" id="personassignrole" name="personassignrole">
							<option value="0">Select</option>
						<% for (var i = 1; i <= assignedRole.length; i += 1) { %>
							<option value="<%= assignedRole[i - 1] %>"><%= assignedRole[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="personassigntype">Assignment Type</label>
						<select class="form-control" id="personassigntype" name="personassigntype">
							<option value="0">Select</option>
						<% for (var i = 1; i <= assignmentType.length; i += 1) { %>
							<option value="<%= assignmentType[i - 1] %>"><%= assignmentType[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
			</div><!-- row -->
			</fieldset>
			<div class="row">
				<div class="col-xs-12">
					<div class="form-group">
						<label for="personassignmentendreason">End Reason</label>
						<textarea class="form-control" id="personassignmentendreason" name="personassignmentendreason"></textarea>
					</div>
				</div>
				<div class="col-sm-6" hidden>
					<label for="personassign_caseid">Case ID</label>
					<input type="text" class="form-control" id="personassign_caseid" name="personassign_caseid" readonly value="<%= thiscase.case_id %>"/>
				</div>
			</div><!-- row -->
			<div class="buttonrow">
				<button type="reset" class="btn btn-warning btn-md resetbtn" id="resetpersonassignment" name="resetpersonassignment">Reset</button>
				<button type="submit" class="btn btn-warning btn-md submitbtn" id="submitpersonassignment" name="submitpersonassignment">Submit</button>
			</div>
		</form>

		<% person_assignment.sort(function(a,b) {
			return (a.cases_person_assignment_id > b.cases_person_assignment_id) ? 1 : ((b.cases_person_assignment_id > a.cases_person_assignment_id) ? -1 : 0);
		}); %>
		<% if (person_assignment.length > 0) { %>
		<table id="casepeopledisplaytable" class="table table-responsive table-striped table-condensed">
			<thead>
				<tr class="info">
					<th>Person Name</th>
					<th>Primary Phone</th>
					<th>Primary Email</th>
					<th>Assigned Role</th>
					<th>Assignment Type</th>
					<th>Status</th>
				</tr>
			</thead>
			<tbody>
            <% for (var i = 0; i < person_assignment.length; i += 1) {
				var passign_personid = "passign_personid" + i;
				var passign_role = "passign_role" + i;
				var passign_type = "passign_type" + i;
				var passign_status = "passign_status" + i;
				var passign_startdate = "passign_startdate" + i;
				var passign_enddate = "passign_enddate" + i;
				var passign_endreason = "passign_endreason" + i;
				var endpersonassignment = "endpersonassignment" + i;
				var removepersonassignment = "removepersonassignment" + i;
			%>
				<tr>
					<td><span hidden id="<%= passign_personid %>"><%= person_assignment[i].person_id %></span><a href="/person/<%= person_assignment[i].person_id %>"><%= person_assignment[i].person_name %></a></td>
					<td><%= person_assignment[i].primary_phone %></td>
					<td><%= person_assignment[i].primary_email %></td>
					<td><span id="<%= passign_role %>"><%= person_assignment[i].lk_assigned_role %></span></td>
					<td><span id="<%= passign_type %>"><%= person_assignment[i].lk_case_assignment_type %></span></td>
					<td><span id="<%= passign_status %>"><%= person_assignment[i].lk_status %></span></td>
				</tr>
				<tr>
					<td colspan="5">
						<p><strong>Start Date:</strong> <span id="<%= passign_startdate %>"><%= person_assignment[i].start_date %></span> &nbsp;&nbsp; <strong>End Date:</strong> <span class="endpa" id="<%= passign_enddate %>"><%= person_assignment[i].end_date %></span></p>				
						<p><strong>End Reason:</strong> <span id="<%= passign_endreason %>"><%= person_assignment[i].end_reason %></span></p>
					</td>
					<td class="tablebtns" id="<%= person_assignment[i].case_assignment_id %>">
						<button class="btn btn-warning btn-md tableendbtn personassignmentendbtn" id="<%= endpersonassignment %>"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
	                    <form action="#" method="post">
	                        <button class="btn btn-danger btn-md tableremovebtn endthisbtn" id="<%= removepersonassignment %>" name="removepersonassignment"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
	                    </form>
					</td>
				</tr>
            <% } %>
			</tbody>
		</table>
        <% } %>

		</div><!-- tabpanel assignedpeople -->

 
<!-- **************************************************************************************************** -->


	<div role="tabpanel" class="tab-pane" id="assignedorganizations">

<div class="buttonrow creatediv">
	<p><a href="/organization" class="btn btn-primary btn-md" id="createorganizationbtn">Create Organization</a></p>
</div>

	<h4><button id="plusorganizationassignment" class="btn btn-default btn-md plusbtn2"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> Organization</h4>
	
		<form id="organizationassignmentform" class="toggleform" action="/organizationassignment" method="post">
        <fieldset id="ableorganizationassignment">
			<div class="row">
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="organizationassignorgid">Organization Name</label>
						<select class="form-control requiredfield" id="organizationassignorgid" name="organizationassignorgid">
							<option value="0" selected>Select</option>
					<% organization.sort(function(a,b) {
						return (a.organization_id > b.organization_id) ? 1 : ((b.organization_id > a.organization_id) ? -1 : 0);
					}); %>
					<% for (var i = 0; i < organization.length; i += 1) { %>
							<option value="<%= organization[i].organization_id %>"><%= organization[i].organization_name %></option>
					<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="organizationassignrole">Assigned Role</label>
						<select class="form-control requiredfield" id="organizationassignrole" name="organizationassignrole">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= assignedRole.length; i += 1) { %>
							<option value="<%= assignedRole[i - 1] %>"><%= assignedRole[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="organizationassigntype">Assignment Type</label>
						<select class="form-control" id="organizationassigntype" name="organizationassigntype">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= assignmentType.length; i += 1) { %>
							<option value="<%= assignmentType[i - 1] %>"><%= assignmentType[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
			</div><!-- row -->
			</fieldset>
			<div class="row">
				<div class="col-xs-12">
					<div class="form-group">
						<label for="organizationassignmentendreason">End Reason</label>
						<textarea class="form-control" id="organizationassignmentendreason" name="organizationassignmentendreason" disabled></textarea>
					</div>
				</div>
				<div class="col-sm-6" hidden>
					<label for="organizationassign_caseid">Case ID</label>
					<input type="text" class="form-control" id="organizationassign_caseid" name="organizationassign_caseid" readonly value="<%= thiscase.case_id %>"/>
				</div>
			</div><!-- row -->
			<div class="buttonrow">
				<button type="reset" class="btn btn-warning btn-md resetbtn" id="resetorganizationassignment" name="resetorganizationassignment">Reset</button>
				<button type="submit" class="btn btn-warning btn-md submitbtn" id="submitorganizationassignment" name="submitorganizationassignment">Submit</button>
			</div>
		</form>

		<% organization_assignment.sort(function(a,b) {
			return (a.case_assignment_id > b.case_assignment_id) ? 1 : ((b.case_assignment_id > a.case_assignment_id) ? -1 : 0);
		}); %>
		<% if (organization_assignment.length > 0) { %>
		<table id="caseorganizationdisplaytable" class="table table-responsive table-striped table-condensed">
			<thead>
				<tr class="info">
					<th>Organization Name</th>
					<th>Primary Phone</th>
					<th>Primary Email</th>
					<th>Assigned Role</th>
					<th>Assignment Type</th>
					<th>Status</th>
				</tr>
			</thead>
			<tbody>
            <% for (var i = 0; i < organization_assignment.length; i += 1) {
				var oassign_organizationid = "oassign_organizationid" + i;
				var oassign_role = "oassign_role" + i;
				var oassign_type = "oassign_type" + i;
				var oassign_status = "oassign_status" + i;
				var oassign_startdate = "oassign_startdate" + i;
				var oassign_enddate = "oassign_enddate" + i;
				var oassign_endreason = "oassign_endreason" + i;
				var endorganizationassignment = "endorganizationassignment" + i;
				var removeorganizationassignment = "removeorganizationassignment" + i;
			%>
				<tr>
					<td><span hidden id="<%= oassign_organizationid %>"><%= organization_assignment[i].organization_id %></span><a href="/organization/<%= organization_assignment[i].organization_id %>"><%= organization_assignment[i].organization_name %></a></td>
					<td><%= organization_assignment[i].primary_phone %></td>
					<td><%= organization_assignment[i].primary_email %></td>
					<td><span id="<%= oassign_role %>"><%= organization_assignment[i].lk_assigned_role %></span></td>
					<td><span id="<%= oassign_type %>"><%= organization_assignment[i].lk_case_assignment_type %></span></td>
					<td><span id="<%= oassign_status %>"><%= organization_assignment[i].lk_status %></span></td>
				</tr>
				<tr>
					<td colspan="5">
						<p><strong>Start Date:</strong> <span id="<%= oassign_startdate %>"><%= organization_assignment[i].start_date %></span> &nbsp;&nbsp; <strong>End Date:</strong> <span class="endoa" id="<%= oassign_enddate %>"><%= organization_assignment[i].end_date %></span></p>				
						<p><strong>End Reason:</strong> <span id="<%= oassign_endreason %>"><%= organization_assignment[i].end_reason %></span></p>
					</td>
					<td class="tablebtns" id="<%= organization_assignment[i].case_assignment_id %>">
						<button class="btn btn-warning btn-md tableendbtn organizationassignmentendbtn" id="<%= endorganizationassignment %>"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
	                    <form action="#" method="post">
	                        <button class="btn btn-danger btn-md tableremovebtn endthisbtn" id="<%= removeorganizationassignment %>" name="removeorganizationassignment"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
	                    </form>
					</td>
				</tr>
            <% } %>
			</tbody>
		</table>
        <% } %>

		</div><!-- tabpanel assignedorganizations -->



<!-- ************************************************************************************************************************ -->



		<div role="tabpanel" class="tab-pane" id="goals">

		<h4><button id="plusgoal" class="btn btn-default btn-md plusbtn"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> Goal</h4>

		<form id="goalform" class="toggleform" action="/goal" method="post">
			<div class="row">
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="goalname">Goal Name</label>
						<input type="text" required class="form-control requiredfield" id="goalname" name="goalname" size="90" maxlength="100" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="goaltype">Type</label>
						<select class="form-control" id="goaltype" name="goaltype">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= goalType.length; i += 1) { %>
							<option value="<%= goalType[i - 1] %>"><%= goalType[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="goalpriority">Priority</label>
						<select class="form-control" id="goalpriority" name="goalpriority">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= casePriority.length; i += 1) { %>
							<option value="<%= casePriority[i - 1] %>"><%= casePriority[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="goalstartdate">Start Date</label>
						<input type="text" class="form-control" id="goalstartdate" name="goalstartdate" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="goalduedate">Due Date</label>
						<input type="text" class="form-control" id="goalduedate" name="goalduedate" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="goalcompletedate">Complete Date</label>
						<input type="text" class="form-control" id="goalcompletedate" name="goalcompletedate" disabled value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="goalassignedpersonid">Assigned To</label>
						<select class="form-control" id="goalassignedpersonid" name="goalassignedpersonid">
							<option value="0" selected>Select</option>
							<% for (var i = 0; i < person.length; i += 1) { %>
							<option value="<%= person[i].person_id %>"><%= person[i].last_name %>, <%= person[i].first_name %> <%= person[i].middle_name %></option>
                            <% } %>
						</select>
					</div>
				</div>
			</div><!-- row -->
			<div class="row">
				<div class="col-xs-12">
					<div class="form-group">
						<label for="goalnote">Note</label>
						<textarea class="form-control" id="goalnote" name="goalnote"></textarea>
					</div>
				</div>
			</div><!-- row -->
			<div class="row">
				<div class="col-sm-6" hidden>
					<label for="goalcaseid">Case ID</label>
					<input type="text" class="form-control" id="goalcaseid" name="goalcaseid" readonly value="<%= thiscase.case_id %>"/>
				</div>
			</div><!-- row -->
			<div class="buttonrow">
				<button type="reset" class="btn btn-warning btn-md resetbtn" id="resetgoal" name="resetgoal">Reset</button>
				<button type="submit" class="btn btn-warning btn-md submitbtn" id="submitgoal" name="submitgoal">Submit</button>
			</div>
		</form>

		<div id="goaluploadformdiv" class="uploadform">
			<h4>Upload File(s)</h4>
			<p>Maximum 10 files uploaded at once.</p>
		    <form id    = "goaluploadForm"			    
		        enctype = "multipart/form-data"
		        action  = "/goal/upload/"
		        method  = "post"
		    >
			<div class="row" hidden>
				<label for="uploadgoalcase_id">Case ID</label>
				<input type="text" class="form-control" id="uploadgoalcase_id" name="uploadgoalcase_id" readonly value="<%= thiscase.case_id %>"/>
			</div><!-- row -->
			<div class="row">
				<div class="col-xs-12">
					<input type="file" class="btn btn-primary btn-md uploadgoalbtn" id="goalbrowsebtn1" name="userFile" />
				</div>
				<div class="col-xs-12">
					<input type="file" class="btn btn-primary btn-md uploadgoalbtn" id="goalbrowsebtn2" name="userFile" />
				</div>
				<div class="col-xs-12">
					<input type="file" class="btn btn-primary btn-md uploadgoalbtn" id="goalbrowsebtn3" name="userFile" />
				</div>
			</div><!-- row -->
			<div id="uploadgoalbtns" class="row">
			</div><!-- row -->
			<div class="buttonrow">
				<button type="button" class="btn btn-primary btn-md adduploadbtn" id="addgoaluploadbtn" name="addgoaluploadbtn">Add File</button>
				<button type="reset" class="btn btn-warning btn-md canceluploadbtn" id="canceldocgoal" name="canceldocgoal">Cancel</button>
				<button type="submit" class="btn btn-warning btn-md uploadsubmitbtn" id="submitdocgoal" name="submitdocgoal">Submit</button>
			</div><!-- row -->
			</form>			
		</div><!-- goaluploadformdiv -->


        <div class="form-group">
           <span id="goaltypebtns"></span>
		</div>
	<% if (this_cases_goals.length > 0) { %>
		<table id="goaldisplaytable" class="table table-responsive table-striped table-condensed 2rowremovebtntop">
			<thead>
				<tr class="info">
					<th>Goal Name</th>
					<th>Type</th>
					<th>Priority</th>
					<th>Due Date</th>
					<th>Assigned To</th>
					<th>&nbsp;</th>
				</tr>
			</thead>
			<tbody>
		<%  var numcompletegoals = 0;
	 		var percent_complete_goals = 0;
			for (var i = 0; i < this_cases_goals.length; i += 1) {
		        var goaldisplayrow = "goaldisplayrow" + this_cases_goals[i].goal_id;
				var goalname = "goalname" + i; 
				var goaltype = "goaltype" + i; 
				var goalduedate = "goalduedate" + i; 
				var goalpriority = "goalpriority" + i; 
				var goalassignedpersonid = "goalassignedpersonid" + i; 
				var goalstartdate = "goalstartdate" + i; 
				var goalcompletedate = "goalcompletedate" + i; 
				var goalnote = "goalnote" + i; 
				var editcasesgoal = "editcasesgoal" + i;
				var removecasesgoal = "removecasesgoal" + i;
				var uploaddocgoalbtn = "uploaddocgoalbtn" + this_cases_goals[i].goal_id;
		%>
				<tr id="<%= goaldisplayrow %>" class="goal<%= this_cases_goals[i].type %>row">
					<td><span id="<%= goalname %>"><%= this_cases_goals[i].name %></span></td>
					<td id="<%= goaltype %>"><%= this_cases_goals[i].type %></td>
					<td id="<%= goalpriority %>"><%= this_cases_goals[i].priority %></td>
					<td id="<%= goalduedate %>"><%= this_cases_goals[i].due_date %></td>
					<td id="<%= goalassignedpersonid %>"><a href="/person/<%= this_cases_goals[i].assignedperson_id %>"><%= this_cases_goals[i].assignedperson_id %></a></td>
					<td class="tablebtns" id="<%= this_cases_goals[i].goal_id %>">
						<button class="btn btn-primary btn-md tableeditbtn casesgoaleditbtn" id="<%= editcasesgoal %>"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></button>
                        <button class="btn btn-danger btn-md tableremovebtn" id="<%= removecasesgoal %>"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
 					</td>
				</tr>
				<tr class="goal<%= this_cases_goals[i].type %>row">
					<td colspan="6">						
                        <a href="#goaluploadformdiv"><button class="btn btn-default btn-md uploaddocbtn" id="<%= uploaddocgoalbtn %>">Upload File</button></a><br>
						<p><strong>Start Date:</strong> <span id="<%= goalstartdate %>"><%= this_cases_goals[i].start_date %></span> &nbsp;&nbsp; <strong>Complete Date:</strong> <span id="<%= goalcompletedate %>"><%= this_cases_goals[i].complete_date %></span></p>
						<p><strong>Note:</strong> <span id="<%= goalnote %>"><%= this_cases_goals[i].note %></span></p>
					<% for (var f = 0; f < this_cases_goals[i].goal_doc.length; f += 1) {
					   if (this_cases_goals[i].goal_doc[f] !== "") {
				           var goaldoc = "goaldoc" + i + '-' + f; 
						   var removegoaldoc = "removegoaldoc" + i + '-' + f; 
					   %>
						<form method="GET" action="/download/<%= thiscase.case_id %>/goalfiles/<%= this_cases_goals[i].goal_doc[f] %>">
							<strong>Attachment:</strong>: <input type="text" class="downloadfilename" id="<%= goaldoc %>" name="urlgoalfile" readonly value="<%= this_cases_goals[i].goal_doc[f] %>"/>
                        	<button type="submit" class="btn btn-default btn-md downloadbtn"><span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span></button>
						</form>
						<form id="removegoaldocform" method="POST" action="/goal/removedoc/<%= this_cases_goals[i].goal_id %>/<%= f %>">
							<button class="btn btn-default btn-md oneline docremovebtn" id="<%= removegoaldoc %>"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
						</form>
					<% } } %>
					<div class="navchildren">
						<p>Plans <a href="#plans"><button class="btn btn-default btn-md childrenanchorbtn" id="linkheadassociatedgoal<%= this_cases_goals[i].goal_id %>"><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span></button></a></p>
					</div>
					</td>
				</tr>
				<% 	if (this_cases_goals[i].complete_date !== "") {
						numcompletegoals += 1;
					}
				%>
				<% if ((this_cases_goals.length === 1) || (i === this_cases_goals.length - 1)) {
						percent_complete_goals = ((numcompletegoals / this_cases_goals.length) * 100).toFixed(0);
				%>
					<tr>
					<% if (percent_complete_goals == 100) { %>
						<td class="totalcomplete-done">
					<% } else if (percent_complete_goals < 50) { %>
						<td class="totalcomplete-less">
					<% } else { %>
						<td class="totalcomplete-more">
					<% } %>
						<%= percent_complete_goals %>&percnt; Complete Goals</td>
					</tr>
			<% } } %>					
 			</tbody>
		</table>
		<% } %>

		</div><!-- tabpanel goals -->



<!-- ************************************************************************************************************************ -->



		<div role="tabpanel" class="tab-pane" id="plans">

		<h4><button id="plusplan" class="btn btn-default btn-md plusbtn"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> Plan</h4>

		<form id="planform" class="toggleform" action="/plan" method="post">
			<div class="row">
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="planname">Plan Name</label>
						<input type="text" required class="form-control requiredfield" id="planname" name="planname" size="90" maxlength="100" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="plantype">Type</label>
						<select class="form-control" id="plantype" name="plantype">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= planType.length; i += 1) { %>
							<option value="<%= planType[i - 1] %>"><%= planType[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="planpriority">Priority</label>
						<select class="form-control" id="planpriority" name="planpriority">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= casePriority.length; i += 1) { %>
							<option value="<%= casePriority[i - 1] %>"><%= casePriority[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="planstartdate">Start Date</label>
						<input type="text" class="form-control" id="planstartdate" name="planstartdate" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="planduedate">Due Date</label>
						<input type="text" class="form-control" id="planduedate" name="planduedate" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="plancompletedate">Complete Date</label>
						<input type="text" class="form-control" id="plancompletedate" name="plancompletedate" disabled value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="assocgoalid">Associated Goal</label>
						<select class="form-control requiredfield" id="assocgoalid" name="assocgoalid">
							<option value="0" selected>Select</option>
					<% this_cases_goals.sort(function(a,b) {
						return (a.goal_id > b.goal_id) ? 1 : ((b.goal_id > a.goal_id) ? -1 : 0);
					}); %>
					<% for (var i = 0; i < this_cases_goals.length; i += 1) { %>
							<option value="<%= this_cases_goals[i].goal_id %>"><%= this_cases_goals[i].name %></option>
					<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="planassignedpersonid">Assigned To</label>
						<select class="form-control" id="planassignedpersonid" name="planassignedpersonid">
							<option value="0" selected>Select</option>
							<% for (var i = 0; i < person.length; i += 1) { %>
							<option value="<%= person[i].person_id %>"><%= person[i].last_name %>, <%= person[i].first_name %> <%= person[i].middle_name %></option>
                            <% } %>
						</select>
					</div>
				</div>
			</div><!-- row -->
			<div class="row">
				<div class="col-xs-12">
					<div class="form-group">
						<label for="plannote">Note</label>
						<textarea class="form-control" id="plannote" name="plannote"></textarea>
					</div>
				</div>
			</div><!-- row -->
			<div class="row">
				<div class="col-sm-6" hidden>
					<label for="plancaseid">Case ID</label>
					<input type="text" class="form-control" id="plancaseid" name="plancaseid" readonly value="<%= thiscase.case_id %>"/>
				</div>
			</div><!-- row -->
			<div class="buttonrow">
				<button type="reset" class="btn btn-warning btn-md resetbtn" id="resetplan" name="resetplan">Reset</button>
				<button type="submit" class="btn btn-warning btn-md submitbtn" id="submitplan" name="submitplan">Submit</button>
			</div>
		</form>

		<div id="planuploadformdiv" class="uploadform">
			<h4>Upload File(s)</h4>
			<p>Maximum 10 files uploaded at once.</p>
		    <form id    = "planuploadForm"			    
		        enctype = "multipart/form-data"
		        action  = "/plan/upload/"
		        method  = "post"
		    >
			<div class="row" hidden>
				<label for="uploadplancase_id">Case ID</label>
				<input type="text" class="form-control" id="uploadplancase_id" name="uploadplancase_id" readonly value="<%= thiscase.case_id %>"/>
			</div><!-- row -->
			<div class="row">
				<div class="col-xs-12">
					<input type="file" class="btn btn-primary btn-md uploadplanbtn" id="planbrowsebtn1" name="userFile" />
				</div>
				<div class="col-xs-12">
					<input type="file" class="btn btn-primary btn-md uploadplanbtn" id="planbrowsebtn2" name="userFile" />
				</div>
				<div class="col-xs-12">
					<input type="file" class="btn btn-primary btn-md uploadplanbtn" id="planbrowsebtn3" name="userFile" />
				</div>
			</div><!-- row -->
			<div id="uploadplanbtns" class="row">
			</div><!-- row -->
			<div class="buttonrow">
				<button type="button" class="btn btn-primary btn-md adduploadbtn" id="addplanuploadbtn" name="addplanuploadbtn">Add File</button>
				<button type="reset" class="btn btn-warning btn-md canceluploadbtn" id="canceldocplan" name="canceldocplan">Cancel</button>
				<button type="submit" class="btn btn-warning btn-md uploadsubmitbtn" id="submitdocplan" name="submitdocplan">Submit</button>
			</div><!-- row -->
			</form>			
		</div><!-- planuploadformdiv -->

        <div class="form-group">
           <label for="expandplan" class="btn btn-sm btn-default">
              <input type="radio" name="showplans" id="expandplan" class="expandtablesbtn" checked> Show Tables
           </label>
           <label for="collapseplan" class="btn btn-sm btn-default">
              <input type="radio" name="showplans" id="collapseplan" class="collapsetablesbtn"> Hide Tables
           </label>
           <span id="plantypebtns"></span>
		</div>

		<%  for (var i = 0; i < this_cases_plans.length; i += 1) {
		        var plandisplaytable = "plandisplaytable" + i;
		        var plandisplayrow = "plandisplayrow" + this_cases_plans[i].plan_id;
				var planname = "planname" + i; 
				var plantype = "plantype" + i; 
				var planduedate = "planduedate" + i; 
				var planpriority = "planpriority" + i; 
				var assocgoalid = "assocgoalid" + i; 
				var planassignedpersonid = "planassignedpersonid" + i; 
				var planstartdate = "planstartdate" + i; 
				var plancompletedate = "plancompletedate" + i; 
				var plannote = "plannote" + i; 
				var editcasesplan = "editcasesplan" + i;
				var removecasesplan = "removecasesplan" + i; 
				var uploaddocplanbtn = "uploaddocplanbtn" + this_cases_plans[i].plan_id;
		%>
		<% if ((i === 0) || ((i > 0) && (this_cases_plans[i - 1].assocgoal_id !== this_cases_plans[i].assocgoal_id))) { 
                var numplans = 0;
				var numcompleteplans = 0;
		%>
		<h6><a href="#goals"><button class="btn btn-default btn-md parentanchorbtn" id="linkgoaldisplayrow<%= this_cases_plans[i].assocgoal_id %>"><span class="glyphicon glyphicon-triangle-left" aria-hidden="true"></span></button></a> <button id="headassociatedgoal<%= this_cases_plans[i].assocgoal_id %>" class="btn btn-primary btn-md associatedheadbtn"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> Plan(s) For Associated Goal: <%= this_cases_plans[i].assocgoal_name %></h6>
		<div id="divassociatedgoal<%= this_cases_plans[i].assocgoal_id %>" class="displayplan_div">
		<table id="<%= plandisplaytable %>" class="table table-responsive table-striped table-condensed 2rowremovebtntop">
			<thead>
				<tr class="info">
					<th>Plan Name</th>
					<th>Type</th>
					<th>Priority</th>
					<th>Due Date</th>
					<th>Assigned To</th>
					<th>&nbsp;</th>
				</tr>
			</thead>
			<tbody>
		<% } %>
				<tr id="<%= plandisplayrow %>" class="plan<%= this_cases_plans[i].type %>row">
					<td><span hidden id="<%= assocgoalid %>"><%= this_cases_plans[i].assocgoal_id %></span><span id="<%= planname %>"><%= this_cases_plans[i].name %></span></td>
					<td id="<%= plantype %>"><%= this_cases_plans[i].type %></td>
					<td id="<%= planpriority %>"><%= this_cases_plans[i].priority %></td>
					<td id="<%= planduedate %>"><%= this_cases_plans[i].due_date %></td>
					<td id="<%= planassignedpersonid %>"><%= this_cases_plans[i].assignedperson_id %></td>
					<td class="tablebtns" id="<%= this_cases_plans[i].plan_id %>">
						<button class="btn btn-primary btn-md tableeditbtn casesplaneditbtn" id="<%= editcasesplan %>"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></button>
                        <button class="btn btn-danger btn-md tableremovebtn" id="<%= removecasesplan %>"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
 					</td>
				</tr>
				<tr class="plan<%= this_cases_plans[i].type %>row">
					<td colspan="6">	
                        <a href="#planuploadformdiv"><button class="btn btn-default btn-md uploaddocbtn" id="<%= uploaddocplanbtn %>">Upload File</button></a><br>
						<p><strong>Start Date:</strong> <span id="<%= planstartdate %>"><%= this_cases_plans[i].start_date %></span> &nbsp;&nbsp; <strong>Complete Date:</strong> <span id="<%= plancompletedate %>"><%= this_cases_plans[i].complete_date %></span></p>
						<p><strong>Note:</strong> <span id="<%= plannote %>"><%= this_cases_plans[i].note %></span></p>
					<% for (var f = 0; f < this_cases_plans[i].plan_doc.length; f += 1) {
					   if (this_cases_plans[i].plan_doc[f] !== "") {
					   	  var plandoc = "plandoc" + i + '-' + f;
						  var removeplandoc = "removeplandoc" + i + '-' + f; 
					   %>
						<form method="GET" action="/download/<%= thiscase.case_id %>/planfiles/<%= this_cases_plans[i].plan_doc[f] %>">
							<strong>Attachment:</strong>: <input type="text" class="downloadfilename" id="<%= plandoc %>" name="urlplanfile" readonly value="<%= this_cases_plans[i].plan_doc[f] %>"/>
                        	<button type="submit" class="btn btn-default btn-md downloadbtn"><span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span></button>
						</form>
						<form id="removeplandocform" method="POST" action="/plan/removedoc/<%= this_cases_plans[i].plan_id %>/<%= f %>">
							<button class="btn btn-default btn-md oneline docremovebtn" id="<%= removeplandoc %>"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
						</form>
					<% } } %>
					<div class="navchildren">
						<p>Actions <a href="#actions"><button class="btn btn-default btn-md childrenanchorbtn" id="linkheadassociatedplan<%= this_cases_plans[i].plan_id %>"><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span></button></a></p>
					</div>
					</td>
				</tr>
                <%  numplans += 1;
                    if (this_cases_plans[i].complete_date !== "") {
					    numcompleteplans += 1;
					}
				%>
			<% if ((this_cases_plans.length === 1) || (i === this_cases_plans.length - 1) || ((i < this_cases_plans.length) && (this_cases_plans[i].assocgoal_id !== this_cases_plans[i + 1].assocgoal_id))) {
				if (numplans !== 0) {
				  	var percent_complete_plans = ((numcompleteplans / numplans) * 100).toFixed(0);
				} else {
					var percent_complete_plans = 0;
				}
			%>
			    <tr>
					<% if (percent_complete_plans == 100) { %>
					<td class="totalcomplete-done">
					<% } else if (percent_complete_plans < 50) { %>
					<td class="totalcomplete-less">
					<% } else { %>
					<td class="totalcomplete-more">
                	<% } %>
					<%= percent_complete_plans %>&percnt; Complete Plans for Goal: <%= this_cases_plans[i].assocgoal_name %></td>
				</tr>
			</tbody>
		</table>
		</div>
        <% } } %>

		</div><!-- tabpanel plans -->




<!-- ************************************************************************************************************************ -->



		<div role="tabpanel" class="tab-pane" id="actions">

		<h4><button id="plustask" class="btn btn-default btn-md plusbtn"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> Task</h4>

		<form id="taskform" class="toggleform" action="/task" method="post">
			<div class="row">
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="tasksubject">Subject</label>
						<input type="text" required class="form-control requiredfield" id="tasksubject" name="tasksubject" size="90" maxlength="100" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="tasktype">Type</label>
						<select class="form-control" id="tasktype" name="tasktype">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= taskType.length; i += 1) { %>
							<option value="<%= taskType[i - 1] %>"><%= taskType[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="taskpriority">Priority</label>
						<select class="form-control" id="taskpriority" name="taskpriority">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= casePriority.length; i += 1) { %>
							<option value="<%= casePriority[i - 1] %>"><%= casePriority[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="taskstartdate">Start Date</label>
						<input type="text" class="form-control" id="taskstartdate" name="taskstartdate" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="taskduedate">Due Date</label>
						<input type="text" class="form-control" id="taskduedate" name="taskduedate" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="taskcompletedate">Complete Date</label>
						<input type="text" class="form-control" id="taskcompletedate" name="taskcompletedate" disabled value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="taskassignedperson">Assigned To</label>
						<select class="form-control" id="taskassignedperson" name="taskassignedperson">
							<option value="0" selected>Select</option>
							<% for (var i = 0; i < person.length; i += 1) { %>
							<option value="<%= person[i].person_id %>"><%= person[i].last_name %>, <%= person[i].first_name %> <%= person[i].middle_name %></option>
                            <% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="taskstatus">Status</label>
						<select class="form-control" id="taskstatus" name="taskstatus">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= taskStatus.length; i += 1) { %>
							<option value="<%= taskStatus[i - 1] %>"><%= taskStatus[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-12">
					<div class="form-group">
						<label for="tasknote">Note</label>
						<textarea class="form-control" id="tasknote" name="tasknote"></textarea>
					</div>
				</div>
			</div><!-- row -->
			<div class="row">
				<div class="col-sm-6" hidden>
					<label for="taskcaseid">Case ID</label>
					<input type="text" class="form-control" id="taskcaseid" name="taskcaseid" readonly value="<%= thiscase.case_id %>"/>
				</div>
			</div><!-- row -->
			<div class="buttonrow">
				<button type="reset" class="btn btn-warning btn-md resetbtn" id="resettask" name="resettask">Reset</button>
				<button type="submit" class="btn btn-warning btn-md submitbtn" id="submittask" name="submittask">Submit</button>
			</div>
			<br>
		</form>

	<button class="btn btn-default moreactionlogbtn" id="btnactionstaskstable">Tasks</button>

	<div id="actionstaskstable">

		<table id="tasksdisplaytable" class="table table-responsive table-striped table-condensed 2rowremovebtntop">
			<thead>
				<tr class="info">
					<th>Task Subject</th>
					<th>Type</th>
					<th>Priority</th>
					<th>Due Date</th>
					<th>Assigned To</th>
					<th>Status</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
			<% taskscaselisting.sort(function(a,b) {
			    return (a.task_id > b.task_id) ? 1 : ((b.task_id > a.task_id) ? -1 : 0);
			}); %>
            <%  var numtasks = 0;
                var numcompletetasks = 0;
		    %>
           <% for (var i = 0; i < taskscaselisting.length; i += 1) {
				var tsubject = "tsubject" + i;
				var ttype = "ttype" + i;
				var tpriority = "tpriority" + i;
				var tstart = "tstart" + i;
				var tdue = "tdue" + i;
				var tcomplete = "tcomplete" + i;
				var tpersonid = "tpersonid" + i;
				var tstatus = "tstatus" + i;
				var tnote = "tnote" + i;
				var task = "task" + i;
				var edittask = "edittask" + i;
				var removetask = "removetask" + i;
			%>
				<tr>
					<td id="<%= tsubject %>"><%= taskscaselisting[i].subject %></td>
					<td id="<%= ttype %>"><%= taskscaselisting[i].type %></td>
					<td id="<%= tpriority %>"><%= taskscaselisting[i].priority %></td>
					<td id="<%= tdue %>"><%= taskscaselisting[i].due_date %></td>
					<td><span hidden id="<%= tpersonid %>"><%= taskscaselisting[i].person_id %></span><a href="/person/<%= taskscaselisting[i].person_id %>"><%= taskscaselisting[i].person_name %></a></td>
					<td id="<%= tstatus %>"><%= taskscaselisting[i].task_status %></td>
					<td class="tablebtns" id="<%= taskscaselisting[i].task_id %>">
						<button class="btn btn-primary btn-md tableeditbtn taskeditbtn" id="<%= edittask %>"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></button>
						<button class="btn btn-default morebtn" type="button" data-toggle="collapse" data-target="#<%= task %>" aria-expanded="false" aria-controls="<%= task %>"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span></button>
                        <button class="btn btn-danger btn-md tableremovebtn" id="<%= removetask %>"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
					</td>
				</tr>
				<tr>
					<td colspan="8">						
						<div class="collapse" id="<%= task %>">
							<p><strong>Start Date:</strong> <span id="<%= tstart %>"><%= taskscaselisting[i].start_date %></span> &nbsp;&nbsp; 
							<strong>Complete Date:</strong> <span id="<%= tcomplete %>"><%= taskscaselisting[i].complete_date %></span></p>
							<p><strong>Note:</strong> <span id="<%= tnote %>"><%= taskscaselisting[i].note %></span></p>
						</div>
					</td>
				</tr>
		      </tr>
                <%  numtasks += 1;
                    if (taskscaselisting[i].complete_date !== "") {
					    numcompletetasks += 1;
					}
				%>
			<% } %>
				<%  if (numtasks != 0) {
				    	var percent_complete_tasks = ((numcompletetasks / numtasks) * 100).toFixed(0);
					} else {
						var percent_complete_tasks = 0;
					}
				%>
			    <tr>
					<% if (percent_complete_tasks == 100) { %>
					<td class="totalcomplete-done">
					<% } else if (percent_complete_tasks < 50) { %>
					<td class="totalcomplete-less">
					<% } else { %>
					<td class="totalcomplete-more">
                	<% } %>
					<%= percent_complete_tasks %>&percnt; of Tasks Complete</td>
				</tr>
			</tbody>
		</table>

	</div><!-- actionstaskstable -->


		<h4><button id="plusaction" class="btn btn-default btn-md plusbtn"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> Action</h4>

		<form id="actionform" class="toggleform" action="/action" method="post">
			<div class="row">
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="actionname">Action Name</label>
						<input type="text" required class="form-control requiredfield" id="actionname" name="actionname" size="90" maxlength="100"/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="actiontype">Type</label>
						<select class="form-control" id="actiontype" name="actiontype">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= actionType.length; i += 1) { %>
							<option value="<%= actionType[i - 1] %>"><%= actionType[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="actionpriority">Priority</label>
						<select class="form-control" id="actionpriority" name="actionpriority">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= casePriority.length; i += 1) { %>
							<option value="<%= casePriority[i - 1] %>"><%= casePriority[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="actionstartdate">Start Date</label>
						<input type="text" class="form-control" id="actionstartdate" name="actionstartdate" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="actionduedate">Due Date</label>
						<input type="text" class="form-control" id="actionduedate" name="actionduedate" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="actioncompletedate">Complete Date</label>
						<input type="text" class="form-control" id="actioncompletedate" name="actioncompletedate" disabled value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="assocplanid">Associated Plan</label>
						<select class="form-control requiredfield" id="assocplanid" name="assocplanid">
							<option value="0" selected>Select</option>
					<% this_cases_plans.sort(function(a,b) {
						return (a.plan_id > b.plan_id) ? 1 : ((b.plan_id > a.plan_id) ? -1 : 0);
					}); %>
					<% for (var i = 0; i < this_cases_plans.length; i += 1) { %>
							<option value="<%= this_cases_plans[i].plan_id %>"><%= this_cases_plans[i].name %></option>
					<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="actionassignedpersonid">Assigned To</label>
						<select class="form-control" id="actionassignedpersonid" name="actionassignedpersonid">
							<option value="0" selected>Select</option>
							<% for (var i = 0; i < person.length; i += 1) { %>
							<option value="<%= person[i].person_id %>"><%= person[i].last_name %>, <%= person[i].first_name %> <%= person[i].middle_name %></option>
                            <% } %>
						</select>
					</div>
				</div>
			</div><!-- row -->
			<div class="row">
				<div class="col-xs-12">
					<div class="form-group">
						<label for="actionnote">Note</label>
						<textarea class="form-control" id="actionnote" name="actionnote"></textarea>
					</div>
				</div>
			</div><!-- row -->
			<div class="row">
				<div class="col-sm-6" hidden>
					<label for="actioncaseid">Case ID</label>
					<input type="text" class="form-control" id="actioncaseid" name="actioncaseid" readonly value="<%= thiscase.case_id %>"/>
				</div>
			</div><!-- row -->
			<div class="buttonrow">
				<button type="reset" class="btn btn-warning btn-md resetbtn" id="resetaction" name="resetaction">Reset</button>
				<button type="submit" class="btn btn-warning btn-md submitbtn" id="submitaction" name="submitaction">Submit</button>
			</div>
		</form>

		<div id="actionuploadformdiv" class="uploadform">
			<h4>Upload File(s)</h4>
			<p>Maximum 10 files uploaded at once.</p>
		    <form id    = "actionuploadForm"			    
		        enctype = "multipart/form-data"
		        action  = "/action/upload/"
		        method  = "post"
		    >
			<div class="row" hidden>
				<label for="uploadactioncase_id">Case ID</label>
				<input type="text" class="form-control" id="uploadactioncase_id" name="uploadactioncase_id" readonly value="<%= thiscase.case_id %>"/>
			</div><!-- row -->
			<div class="row">
				<div class="col-xs-12">
					<input type="file" class="btn btn-primary btn-md uploadactionbtn" id="actionbrowsebtn1" name="userFile" />
				</div>
				<div class="col-xs-12">
					<input type="file" class="btn btn-primary btn-md uploadactionbtn" id="actionbrowsebtn2" name="userFile" />
				</div>
				<div class="col-xs-12">
					<input type="file" class="btn btn-primary btn-md uploadactionbtn" id="actionbrowsebtn3" name="userFile" />
				</div>
			</div><!-- row -->

			<div id="uploadactionbtns" class="row">
			</div><!-- row -->
			<div class="buttonrow">
				<button type="button" class="btn btn-primary btn-md adduploadbtn" id="addactionuploadbtn" name="addactionuploadbtn">Add File</button>
				<button type="reset" class="btn btn-warning btn-md canceluploadbtn" id="canceldocaction" name="canceldocaction">Cancel</button>
				<button type="submit" class="btn btn-warning btn-md uploadsubmitbtn" id="submitdocaction" name="submitdocaction">Submit</button>
			</div><!-- row -->
			</form>			
		</div><!-- actionuploadformdiv -->

        <div class="form-group">
           <label for="expandaction" class="btn btn-sm btn-default">
              <input type="radio" name="showactions" id="expandaction" class="expandtablesbtn" checked> Show Tables
           </label>
           <label for="collapseaction" class="btn btn-sm btn-default">
              <input type="radio" name="showactions" id="collapseaction" class="collapsetablesbtn"> Hide Tables
           </label>
           <span id="actiontypebtns"></span>           
 		</div>

		<%  for (var i = 0; i < this_cases_actions.length; i += 1) {
		        var actiondisplaytable = "actiondisplaytable" + i;
				var actiondisplayrow = "actiondisplayrow" + this_cases_actions[i].action_id;
				var actionname = "actionname" + i; 
				var actiontype = "actiontype" + i; 
				var actionduedate = "actionduedate" + i; 
				var actionpriority = "actionpriority" + i; 
				var assocplanid = "assocplanid" + i; 
				var actionassignedpersonid = "actionassignedpersonid" + i; 
				var actionstartdate = "actionstartdate" + i; 
				var actioncompletedate = "actioncompletedate" + i; 
				var actionnote = "actionnote" + i; 
				var editcasesaction = "editcasesaction" + i;
				var removecasesaction = "removecasesaction" + i; 
				var uploaddocactionbtn = "uploaddocactionbtn" + this_cases_actions[i].action_id;
		%>
		<% if ((i === 0) || ((i > 0) && (this_cases_actions[i - 1].assocplan_id !== this_cases_actions[i].assocplan_id))) {
                var numactions = 0;
				var numcompleteactions = 0;
		%>
		<h6><a href="#plans"><button class="btn btn-default btn-md parentanchorbtn" id="linkplandisplayrow<%= this_cases_actions[i].assocplan_id %>"><span class="glyphicon glyphicon-triangle-left" aria-hidden="true"></span></button></a> <button id="headassociatedplan<%= this_cases_actions[i].assocplan_id %>" class="btn btn-primary btn-md associatedheadbtn"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> Action(s) For Associated Plan: <%= this_cases_actions[i].assocplan_name %></h6>
		<div id="divassociatedplan<%= this_cases_actions[i].assocplan_id %>" class="displayaction_div">
		<table id="<%= actiondisplaytable %>" class="table table-responsive table-striped table-condensed 2rowremovebtntop">
			<thead>
				<tr class="info">
					<th>Action Name</th>
					<th>Type</th>
					<th>Priority</th>
					<th>Due Date</th>
					<th>Assigned To</th>
					<th>&nbsp;</th>
				</tr>
			</thead>
			<tbody>
		<% } %>
				<tr id="<%= actiondisplayrow %>"  class="action<%= this_cases_actions[i].type %>row">
					<td><span hidden id="<%= assocplanid %>"><%= this_cases_actions[i].assocplan_id %></span><span id="<%= actionname %>"><%= this_cases_actions[i].name %></span></td>
					<td id="<%= actiontype %>"><%= this_cases_actions[i].type %></td>
					<td id="<%= actionpriority %>"><%= this_cases_actions[i].priority %></td>
					<td id="<%= actionduedate %>"><%= this_cases_actions[i].due_date %></td>
					<td id="<%= actionassignedpersonid %>"><%= this_cases_actions[i].assignedperson_id %></td>
					<td class="tablebtns" id="<%= this_cases_actions[i].action_id %>">
						<button class="btn btn-primary btn-md tableeditbtn casesactioneditbtn" id="<%= editcasesaction %>"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></button>
                        <button class="btn btn-danger btn-md tableremovebtn" id="<%= removecasesaction %>"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
				</tr>
				<tr class="action<%= this_cases_actions[i].type %>row">
					<td colspan="6">						
                        <a href="#actionuploadformdiv"><button class="btn btn-default btn-md uploaddocbtn" id="<%= uploaddocactionbtn %>">Upload File</button></a><br>
						<p><strong>Start Date:</strong> <span id="<%= actionstartdate %>"><%= this_cases_actions[i].start_date %></span> &nbsp;&nbsp; <strong>Complete Date:</strong> <span id="<%= actioncompletedate %>"><%= this_cases_actions[i].complete_date %></span></p>
						<p><strong>Note:</strong> <span id="<%= actionnote %>"><%= this_cases_actions[i].note %></span></p>
					<% for (var f = 0; f < this_cases_actions[i].action_doc.length; f += 1) {
					    if (this_cases_actions[i].action_doc[f] !== "") {
				           var actiondoc = "actiondoc" + i + '-' + f;
						   var removeactiondoc = "removeactiondoc" + i + '-' + f; 
						%>
						<form method="GET" action="/download/<%= thiscase.case_id %>/actionfiles/<%= this_cases_actions[i].action_doc[f] %>">
							<strong>Attachment:</strong>: <input type="text" class="downloadfilename" id="<%= actiondoc %>" name="urlactionfile" readonly value="<%= this_cases_actions[i].action_doc[f] %>"/>
                        	<button type="submit" class="btn btn-default btn-md downloadbtn"><span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span></button>
						</form>
						<form id="removeactiondocform" method="POST" action="/action/removedoc/<%= this_cases_actions[i].action_id %>/<%= f %>">
							<button class="btn btn-default btn-md oneline docremovebtn" id="<%= removeactiondoc %>"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
						</form>
					<% } } %>
					</td>
				</tr>
                <%  numactions += 1;
                    if (this_cases_actions[i].complete_date !== "") {
					    numcompleteactions += 1;
					}
				%>
			<% if ((this_cases_actions.length === 1) || (i === this_cases_actions.length - 1) || ((i < this_cases_actions.length) && (this_cases_actions[i].assocplan_id !== this_cases_actions[i + 1].assocplan_id))) {
				  if (numactions !== 0) {
				  	var percent_complete_actions = ((numcompleteactions / numactions) * 100).toFixed(0);
				  } else {
				  	var percent_complete_actions = 0;
				  }
			%>
			    <tr>
				<% if (percent_complete_actions == 100) { %>
					<td class="totalcomplete-done">
				<% } else if (percent_complete_actions < 50) { %>
					<td class="totalcomplete-less">
				<% } else { %>
					<td class="totalcomplete-more">
                <% } %>
				<%= percent_complete_actions %>&percnt; Complete Actions for Plan: <%= this_cases_actions[i].assocplan_name %></td>
				</tr>
			</tbody>
		</table>
		</div>
        <% } } %>

	</div><!-- tabpanel actions -->


<!-- ******************************************************************************************************************** -->



		<div role="tabpanel" class="tab-pane" id="casefiles">

		<h4><button id="pluscasefile" class="btn btn-default btn-md plusbtn"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> File</h4>

		<form id="casefileform" class="toggleform" enctype="multipart/form-data" action="/casefile" method="post">
			<div class="row">
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="casefilename">File Name</label>
						<input type="text" class="form-control requiredfield" id="casefilename" name="casefilename"/>
					</div>
				</div>

				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="casefilecasedomain">Case Domain</label>
						<select class="form-control" id="casefilecasedomain" name="casefilecasedomain">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= caseDomain.length; i += 1) { %>
							<option value="<%= caseDomain[i - 1] %>"><%= caseDomain[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="casefileactiontype">Action Type</label>
						<select class="form-control" id="casefileactiontype" name="casefileactiontype">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= actionType.length; i += 1) { %>
							<option value="<%= actionType[i - 1] %>"><%= actionType[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="casefiletype">File Type</label><br>
						<select class="form-control" id="casefiletype" name="casefiletype">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= caseFileType.length; i += 1) { %>
							<option value="<%= caseFileType[i - 1] %>"><%= caseFileType[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="casefilepersoniddisplay">Person Name</label>
						<select class="form-control" id="casefilepersoniddisplay" name="casefilepersoniddisplay" disabled>
							<option value="0" selected>Logged In User Name</option>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="casefileorgid">Organization Name</label>
						<select class="form-control" id="casefileorgid" name="casefileorgid">
							<option value="0" selected>Select</option>
					<% for (var i = 0; i < organization.length; i += 1) { %>
							<option value="<%= organization[i].organization_id %>"><%= organization[i].organization_name %></option>
					<% } %>
						</select>
					</div>
				</div>
			</div><!-- row -->
			<div class="row">
				<div class="col-xs-12">
					<div class="form-group">
						<label for="casefilenote">Note</label>
						<textarea class="form-control" id="casefilenote" name="casefilenote"></textarea>
					</div>
				</div>
			</div><!-- row -->
			<div class="row" hidden>
				<div class="col-sm-6">
					<!--  NOTE: Value will be Logged In User person_id  -->
					<label for="casefilepersonid">Person_Id of Logged In User</label>
					<input type="text" class="form-control" id="casefilepersonid" name="casefilepersonid" value="1"/>
				</div>
				<div class="col-sm-6">
					<label for="casefilecaseid">Case ID</label>
					<input type="text" class="form-control" id="casefilecaseid" name="casefilecaseid" readonly value="<%= thiscase.case_id %>"/>
				</div>
			</div><!-- row -->
			<div class="row">
				<div class="col-xs-12">
					<input type="file" class="btn btn-primary btn-md uploadcasefilebtn" id="casefilebrowsebtn" name="userFile" />
				</div>
			</div><!-- row -->
			<div id="uploadcasefilebtns" class="row">
			</div><!-- row -->
			<div class="buttonrow">
				<button type="button" class="btn btn-primary btn-md adduploadbtn" id="addfileuploadbtn" name="addfileuploadbtn">Add File</button>
				<button type="reset" class="btn btn-warning btn-md resetbtn" id="resetcasefile" name="resetcasefile">Reset</button>
				<button type="submit" class="btn btn-warning btn-md submitbtn" id="submitcasefile" name="submitcasefile">Submit</button>
			</div>
		</form>


        <div class="form-group">
           <span id="filecasedomainbtns"></span>
		</div>

		<% this_cases_files.sort(function(a,b) {
			return (a.casefile_id > b.casefile_id) ? 1 : ((b.casefile_id > a.casefile_id) ? -1 : 0);
		}); %>
		<% if (this_cases_files.length > 0) {
			for (var i = 0; i < this_cases_files.length; i += 1) {
				var casefiledisplaytable = "casefiledisplaytable" + i;
				var filename = "filename" + i; 
				var filedomain = "filedomain" + i; 
				var fileactiontype = "fileactiontype" + i; 
				var filepersonid = "filepersonid" + i; 
				var fileorgid = "fileorgid" + i; 
				var filenote = "filenote" + i; 
				var filetype = "filetype" + i; 
		%>
		<div class="filecasedomain<%= this_cases_files[i].domain %>table">
		<table id="<%= casefiledisplaytable %>" class="table table-responsive table-striped table-condensed 2rowremovebtntop">
			<thead>
				<tr class="info">
					<th>File Name</th>
					<th>Case Domain</th>
					<th>Person Name</th>
					<th>Organization Name</th>
					<th>Date</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td id="<%= filename %>"><%= this_cases_files[i].name %></td>
					<td id="<%= filedomain %>"><%= this_cases_files[i].domain %></td>					
					<td id="<%= filepersonid %>"><%= this_cases_files[i].fileperson_id %></td>
					<td id="<%= fileorgid %>"><%= this_cases_files[i].fileorg_id %></td>						
					<td><%= this_cases_files[i].filedate %></td>
				</tr>
				<tr>
					<td colspan="5">
					    <p><strong>File Type:</strong> <span id="<%= filetype %>"><%= this_cases_files[i].type %></span> &nbsp;&nbsp; <strong>Action Type:</strong> <span id="<%= fileactiontype %>"><%= this_cases_files[i].actiontype %></span></p>
						<p><strong>Note:</strong> <span id="<%= filenote %>"><%= this_cases_files[i].note %></span></p>
					<% if (this_cases_files[i].file_doc.length < 1) { %>
                       <p class="redflag"><strong>WARNING: No file!</strong></p>
                    <% }
                       for (var f = 0; f < this_cases_files[i].file_doc.length; f += 1) {
					   if (this_cases_files[i].file_doc[f] !== "") {
					   	  var filedoc = "filedoc" + i + '-' + f;
					   %>
						<form method="GET" action="/download/<%= thiscase.case_id %>/casefiles/<%= this_cases_files[i].file_doc[f] %>">
							<strong>Attachment:</strong>: <input type="text" id="<%= filedoc %>" class="downloadfilename" name="urlcasefile" readonly value="<%= this_cases_files[i].file_doc[f] %>"/>
                        	<button type="submit" class="btn btn-default btn-md downloadbtn"><span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span></button>
						</form>
					<% } } %>
					</td>
				</tr>
 			</tbody>
		</table>
		</div>
       	<% } } %>

		</div><!-- tabpanel casefiles -->



<!--   ************************************************************************************* -->



		<div role="tabpanel" class="tab-pane" id="casenotes">

		<h4><button id="pluscasenote" class="btn btn-default btn-md plusbtn"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> Note</h4>

		<form id="casenoteform" class="toggleform" action="/casenote" method="post">
			<div class="row">
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="casenotename">Note Name</label>
						<input type="text" class="form-control requiredfield" id="casenotename" name="casenotename"/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="casenotecasedomain">Case Domain</label>
						<select class="form-control" id="casenotecasedomain" name="casenotecasedomain">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= caseDomain.length; i += 1) { %>
							<option value="<%= caseDomain[i - 1] %>"><%= caseDomain[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="casenoteactiontype">Action Type</label>
						<select class="form-control" id="casenoteactiontype" name="casenoteactiontype">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= actionType.length; i += 1) { %>
							<option value="<%= actionType[i - 1] %>"><%= actionType[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="casenotetype">Note Type</label><br>
						<select class="form-control" id="casenotetype" name="casenotetype">
							<option value="0" selected>Select</option>
						<% for (var i = 1; i <= caseNoteType.length; i += 1) { %>
							<option value="<%= caseNoteType[i - 1] %>"><%= caseNoteType[i - 1] %></option>
						<% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="casenotepersoniddisplay">Person Name</label>
						<select class="form-control" id="casenotepersoniddisplay" name="casenotepersoniddisplay" disabled>
							<option value="0" selected>Logged In User Name</option>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="casenoteorgid">Organization Name</label>
						<select class="form-control" id="casenoteorgid" name="casenoteorgid">
							<option value="0" selected>Select</option>
					<% for (var i = 0; i < organization.length; i += 1) { %>
							<option value="<%= organization[i].organization_id %>"><%= organization[i].organization_name %></option>
					<% } %>
						</select>
					</div>
				</div>
			</div><!-- row -->
			<div class="row">
				<div class="col-xs-12">
					<div class="form-group">
						<label for="casenotetext">Note</label>
						<textarea class="form-control requiredfield" id="casenotetext" name="casenotetext" required></textarea>
					</div>
				</div>
			</div><!-- row -->
			<div class="row" hidden>
				<div class="col-sm-6">
					<!--  NOTE: Value will be Logged In User person_id  -->
					<label for="casenotepersonid">Person_Id of Logged In User</label>
					<input type="text" class="form-control" id="casenotepersonid" name="casenotepersonid" value="1"/>
				</div>
				<div class="col-sm-6">
					<label for="casenotecaseid">Case ID</label>
					<input type="text" class="form-control" id="casenotecaseid" name="casenotecaseid" readonly value="<%= thiscase.case_id %>"/>
				</div>
			</div><!-- row -->
			<div class="buttonrow">
				<button type="reset" class="btn btn-warning btn-md resetbtn" id="resetcasenote" name="resetcasenote">Reset</button>
				<button type="submit" class="btn btn-warning btn-md submitbtn" id="submitcasenote" name="submitcasenote">Submit</button>
			</div>
		</form>

        <div class="form-group">
           <span id="notecasedomainbtns"></span>
		</div>

		<% this_cases_notes.sort(function(a,b) {
			return (a.casenote_id > b.casenote_id) ? 1 : ((b.casenote_id > a.casenote_id) ? -1 : 0);
		}); %>
		<%  if (this_cases_notes.length > 0) {
			   for (var i = 0; i < this_cases_notes.length; i += 1) {
					var casenotedisplaytable = "casenotedisplaytable" + i;
					var notename = "notename" + i; 
					var notedomain = "notedomain" + i; 
					var noteactiontype = "noteactiontype" + i; 
					var notepersonid = "notepersonid" + i; 
					var noteorgid = "noteorgid" + i; 
					var notetype = "notetype" + i; 
					var notetext = "notetext" + i; 
					var casenote = "casenote" + this_cases_notes[i].casenote_id;
		%>
	<div class="notecasedomain<%= this_cases_notes[i].domain %>table">
		<table id="<%= casenotedisplaytable %>" class="table table-responsive table-striped table-condensed 2rowremovebtntop">
			<thead>
				<tr class="info">
					<th>Note Name</th>
					<th>Case Domain</th>
					<th>Person Name</th>
					<th>Organization Name</th>
					<th>Date</th>
					<th>&nbsp;</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td id="<%= notename %>"><%= this_cases_notes[i].name %></td>
					<td id="<%= notedomain %>"><%= this_cases_notes[i].domain %></td>					
					<td id="<%= notepersonid %>"><%= this_cases_notes[i].noteperson_id %></td>
					<td id="<%= noteorgid %>"><%= this_cases_notes[i].noteorg_id %></td>						
					<td><%= this_cases_notes[i].notedate %></td>
					<td class="tablebtns">
						<button class="btn btn-default morebtn morenotebtn" type="button" data-toggle="collapse" data-target="#<%= casenote %>" aria-expanded="false" aria-controls="<%= casenote %>"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span></button>
 					</td>
				</tr>
				<tr>
					<td colspan="6">
					    <p><strong>Note Type:</strong> <span id="<%= notetype %>"><%= this_cases_notes[i].type %></span> &nbsp;&nbsp; <strong>Action Type:</strong> <span id="<%= noteactiontype %>"><%= this_cases_notes[i].actiontype %></span></p>
						<div class="collapse in casenote" id="<%= casenote %>">
						    <p id="<%= notetext %>"><%= this_cases_notes[i].note_text %></p>
						</div><!-- casenotesdisplay-->
 					</td>
				</tr>
			</tbody>
		</table>
		</div>
        <% } } %>


		</div><!-- tabpanel casenotes -->



<!-- **********************************************************************************************8 -->



		<div role="tabpanel" class="tab-pane" id="questionnaires">

<div class="buttonrow creatediv">
	<p>
	    <a href="/questionnaires" class="btn btn-primary btn-md" id="managequestionnairebtn">Manage Questionnaire</a>
	</p>
</div>

<h4><button id="pluscasequestionnaire" class="btn btn-default btn-md plusbtn"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> Questionnaire</h4>

	<form id="casequestionnaireform" class="toggleform" action="/casequestionnaire" method="post">
		<div class="row">
			<div class="col-xs-12 col-sm-6">
				<div class="form-group">
					<label for="casequestionnairetype">Questionnaire Type</label>
					<select class="form-control" id="casequestionnairetype" name="casequestionnairetype">
						<option value="0" selected>Select</option>
						<% for (var i = 1; i <= questionnaireType.length; i += 1) { %>
							<option value="<%= questionnaireType[i - 1] %>"><%= questionnaireType[i - 1] %></option>
						<% } %>
					</select>
				</div>
			</div>
			<div class="col-xs-12 col-sm-6">
				<div class="form-group">
					<label for="casequestionnairename">Questionnaire Name</label>
					<select class="form-control requiredfield" id="casequestionnairename" name="casequestionnairename">
						<option value="0" selected>Select</option>
					<% for (var i = 0; i < questionnaire.length; i += 1) { %>
						<option class="<%= questionnaire[i].quest_type %>" value="<%= questionnaire[i].questionnaire_id %>"><%= questionnaire[i].name %></option>
					<% } %>
					</select>
				</div>
			</div>
		</div><!-- row -->
		<div class="row">
			<div class="col-xs-12 col-sm-6">
				<div class="form-group">
					<label for="questcaseassocwith">Associated With</label>
					<select class="form-control" id="questcaseassocwith" name="questcaseassocwith">
						<option value="0" selected>Select</option>
						<% for (var i = 1; i <= questAssociatedWith.length; i += 1) { %>
							<option value="<%= questAssociatedWith[i - 1] %>"><%= questAssociatedWith[i - 1] %></option>
						<% } %>
					</select>
				</div>
			</div>
			<div class="col-xs-12 col-sm-6">
				<div class="form-group">
					<label for="questassocwithname">Associated With Name</label>
					<select class="form-control" id="questassocwithname" name="questassocwithname">
						<option value="0" selected>Select</option>
				<% this_cases_goals.sort(function(a,b) {
					return (a.goal_id > b.goal_id) ? 1 : ((b.goal_id > a.goal_id) ? -1 : 0);
				}); %>
				<% for (var i = 0; i < this_cases_goals.length; i += 1) { %>
						<option class="1" value="<%= this_cases_goals[i].goal_id %>"><%= this_cases_goals[i].name %></option>
				<% } %>
				<% this_cases_plans.sort(function(a,b) {
					return (a.plan_id > b.plan_id) ? 1 : ((b.plan_id > a.plan_id) ? -1 : 0);
				}); %>
				<% for (var i = 0; i < this_cases_plans.length; i += 1) { %>
						<option class="2" value="<%= this_cases_plans[i].plan_id %>"><%= this_cases_plans[i].name %></option>
				<% } %>
				<% this_cases_actions.sort(function(a,b) {
					return (a.action_id > b.action_id) ? 1 : ((b.action_id > a.action_id) ? -1 : 0);
				}); %>
				<% for (var i = 0; i < this_cases_actions.length; i += 1) { %>
						<option class="3" value="<%= this_cases_actions[i].action_id %>"><%= this_cases_actions[i].name %></option>
				<% } %>
					</select>
				</div>
			</div>
		</div><!-- row -->
		<div class="row">
			<div class="col-xs-12 col-sm-6">
				<div class="form-group">
					<label for="casequeststatus">Status</label>
					<select class="form-control requiredfield" id="casequeststatus" name="casequeststatus">
						<option value="0">Select</option>
						<% for (var i = 1; i <= questionnaireStatus.length; i += 1) { %>
							<option value="<%= questionnaireStatus[i - 1] %>"><%= questionnaireStatus[i - 1] %></option>
						<% } %>
					</select>
				</div>
			</div>
			<div class="col-xs-12 col-sm-6 ">
				<div class="form-group">
					<label for="questnote">Note</label>
					<textarea class="form-control" id="questnote" name="questnote"></textarea>
				</div>
			</div>
		</div><!-- row -->
		<div class="row">
			<div hidden class="col-xs-12 col-sm-6">
				<div class="form-group">
					<label for="casequestcaseid">Case ID</label>
					<input type="text" class="form-control" id="casequestcaseid" name="casequestcaseid" readonly value="<%= thiscase.case_id %>"/>
				</div>
			</div>
		</div><!-- row -->
		<div class="buttonrow">
			<button type="reset" class="btn btn-warning btn-md resetbtn" id="resetcasequestionnaire" name="resetcasequestionnaire">Reset</button>
			<button type="submit" class="btn btn-warning btn-md submitbtn" id="submitcasequestionnaire" name="submitcasequestionnaire">Submit</button>
		</div>
	</form>


	<% this_cases_questionnaires.sort(function(a,b) {
		return (a.casequest_id > b.casequest_id) ? 1 : ((b.casequest_id > a.casequest_id) ? -1 : 0);
	}); %>
	<% if (this_cases_questionnaires.length > 0) { %>
		<table id="questionnairedisplaytable" class="table table-responsive table-striped table-condensed">
			<thead>
				<tr class="info">
					<th>Questionnaire Name</th>
					<th>Type</th>
					<th>Associated With: Name</th>
					<th>Date Administered</th>
					<th>Status</th>
				</tr>
			</thead>
			<tbody>
		<%  for (var i = 0; i < this_cases_questionnaires.length; i += 1) {
				var linkcasequestid = "linkcasequestid" + i;
				var linkquestcaseid = "linkquestcaseid" + i;
				var linkquestpersonid = "linkquestpersonid" + i;
				var linkquestionnaire = "linkquestionnaire" + i;
				var casequestionnaireid = "casequestionnaireid" + i;
				var casequestname = "casequestname" + i;
				var casequesttype = "casequesttype" + i;
				var casequestcaseassocwith = "casequestcaseassocwith" + i;
				var casequestassocwithnameid = "casequestassocwithnameid" + i;
				var casequeststatus = "casequeststatus" + i;
				var casequestnote = "casequestnote" + i;
				var viewquestionnaire = "viewquestionnaire" + this_cases_questionnaires[i].questionnaire_id;
				var editcasequest = "editcasequest" + i;
				var removecasequest = "removecasequest" + i;
		%>
				<tr>
					<td><span hidden id="<%= casequestionnaireid %>"><%= this_cases_questionnaires[i].questionnaire_id %></span><span id="<%= casequestname %>"><%= this_cases_questionnaires[i].quest_name %></span></td>
					<td id="<%= casequesttype %>"><%= this_cases_questionnaires[i].quest_type %></td>
					<% if ((this_cases_questionnaires[i].assoc_with !== "0") && (this_cases_questionnaires[i].assocwith_nameid !== "0")) { %>					
					<td><span id="<%= casequestcaseassocwith %>"><%= this_cases_questionnaires[i].assoc_with %></span>: <span id="<%= casequestassocwithnameid %>"><%= this_cases_questionnaires[i].assocwith_nameid %></span></td>
					<% } else { %>
					<td>&nbsp;</td>
					<% } %>					
					<td><%= this_cases_questionnaires[i].date_administered %></td>
					<td id="<%= casequeststatus %>"><%= this_cases_questionnaires[i].quest_status %></td>
				</tr>
				<tr>
					<td colspan="4">
					<p><strong>Total Assigned:</strong> <%= this_cases_questionnaires[i].totalquestassigned %> &nbsp;&nbsp; <strong>Status Started:</strong> <%= this_cases_questionnaires[i].startedquestusers %> &nbsp;&nbsp; <strong>Status Completed:</strong> <%= this_cases_questionnaires[i].completedquestusers %></p>			
						<p><strong>Note:</strong> <span id="<%= casequestnote %>"><%= this_cases_questionnaires[i].note %></span></p>
					</td>
					<td class="tablebtns" id="<%= this_cases_questionnaires[i].casequest_id %>">
	                    <form class="oneline" action="/questionnaire/<%= this_cases_questionnaires[i].questionnaire_id %>" method="POST">
							<input hidden type="text" id="<%= linkcasequestid %>" name="linkcasequestid" readonly value="<%= this_cases_questionnaires[i].casequest_id %>"/>
							<input hidden type="text" id="<%= linkquestcaseid %>" name="linkquestcaseid" readonly value="<%= thiscase.case_id %>"/>
	                        <input hidden type="text" id="<%= linkquestpersonid %>" name="linkquestpersonid" readonly value="<%= person[0].person_id %>"/>
	                        <button type="submit" class="btn btn-success btn-md questviewbtn" id="<%= linkquestionnaire %>" name="linkquestionnaire"><span class="glyphicon glyphicon-link" aria-hidden="true"></span></button>
	                    </form>

						<button class="btn btn-primary btn-md questeditbtn" id="<%= editcasequest %>"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></a></button>

						<% if ((this_cases_questionnaires[i].quest_status === "1") || (this_cases_questionnaires[i].quest_status === "3") || (this_cases_questionnaires[i].quest_status === "4")){ %>
	                        <button class="btn btn-danger btn-md questremovebtn" id="<%= removecasequest %>"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
						<% } else { %>
	                        <button disabled class="btn btn-danger btn-md questremovebtn" id="<%= removecasequest %>"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
						<% } %>
					</td>
				</tr>
			<% } %>		
			</tbody>
		</table>
		<% } %>		

	 	</div><!-- tabpanel questionnaire -->

 
 	</div><!-- tab-content -->

</div><!-- taskpanel -->

</div><!-- cmscontent container -->

<script src="../js/cms_case.js"></script>

<script>
function getcaseinfo() {
    "use strict";
    $("#casetitle").val("<%= thiscase.case_title %>");
    $("#casedescription").val("<%= thiscase.case_description %>");
    $("#casedomain").val("<%= thiscase.lk_case_domain %>");
    $("#casecategory").val("<%= thiscase.lk_case_category %>");
    $("#casestatus").val("<%= thiscase.lk_case_status %>");
    $("#caseseverity").val("<%= thiscase.lk_case_severity %>");
    $("#casepriority").val("<%= thiscase.lk_case_priority %>");
    $("#casetype").val("<%= thiscase.lk_case_type %>");
    $("#casestartdate").val("<%= thiscase.start_date %>");
    $("#caseduedate").val("<%= thiscase.due_date %>");
    $("#casecompletedate").val("<%= thiscase.complete_date %>");
}
getcaseinfo();

(function () {
    "use strict";
    var x = document.querySelectorAll(".endpa");
    var i;
    for (i = 0; i < x.length; i += 1) {
        if (x[i].innerHTML === "") {
            document.getElementById("endpersonassignment" + i).style.visibility = "visible";
            document.getElementById("removepersonassignment" + i).style.visibility = "hidden";
        } else {
            document.getElementById("endpersonassignment" + i).style.visibility = "hidden";
            document.getElementById("removepersonassignment" + i).style.visibility = "visible";
        }
    }

    x = document.querySelectorAll(".endoa");
    for (i = 0; i < x.length; i += 1) {
        if (x[i].innerHTML === "") {
            document.getElementById("endorganizationassignment" + i).style.visibility = "visible";
            document.getElementById("removeorganizationassignment" + i).style.visibility = "hidden";
        } else {
            document.getElementById("endorganizationassignment" + i).style.visibility = "hidden";
            document.getElementById("removeorganizationassignment" + i).style.visibility = "visible";
        }
    }

    $("#actionstaskstable").hide();

    var removereq = $("#caseform .requiredfield");
    var r;
    for (r = 0; r < removereq.length; r += 1) {
        removereq[r].style.borderColor = "#cccccc";
    }

    var t, goaltypeval, goaltypetext, hasgoaltype, goaltypebtn;
    for (t = 1; t < document.getElementById('goaltype').options.length; t += 1) {
        goaltypeval = document.getElementById('goaltype').options[t].value;
        goaltypetext = document.getElementById('goaltype').options[t].text;
        hasgoaltype = document.querySelector(".goal" + goaltypeval + "row");
        if (hasgoaltype !== null) {
            goaltypebtn = '<label for="showgoal' + goaltypeval + '" class="btn btn-sm btn-default"><input type="checkbox" name="showgoaltype" id="showgoal' + goaltypeval + '" class="goaltypebtn" value="' + goaltypeval + '" checked> ' + goaltypetext + '</label>';
        } else {
            goaltypebtn = '<label for="showgoal' + goaltypeval + '" class="btn btn-sm btn-default"><input type="checkbox" name="showgoaltype" id="showgoal' + goaltypeval + '" class="goaltypebtn" value="' + goaltypeval + '" disabled> ' + goaltypetext + '</label>';
        }
        $("#goaltypebtns").append(goaltypebtn);
    }

    var plantypeval, plantypetext, hasplantype, plantypebtn;
    for (t = 1; t < document.getElementById('plantype').options.length; t += 1) {
        plantypeval = document.getElementById('plantype').options[t].value;
        plantypetext = document.getElementById('plantype').options[t].text;
        hasplantype = document.querySelector(".plan" + plantypeval + "row");
        if (hasplantype !== null) {
            plantypebtn = '<label for="showplan' + plantypeval + '" class="btn btn-sm btn-default"><input type="checkbox" name="showplantype" id="showplan' + plantypeval + '" class="plantypebtn" value="' + plantypeval + '" checked> ' + plantypetext + '</label>';
        } else {
            plantypebtn = '<label for="showplan' + plantypeval + '" class="btn btn-sm btn-default"><input type="checkbox" name="showplantype" id="showplan' + plantypeval + '" class="plantypebtn" value="' + plantypeval + '" disabled> ' + plantypetext + '</label>';
        }
        $("#plantypebtns").append(plantypebtn);
    }

    var actiontypeval, actiontypetext, hasactiontype, actiontypebtn;
    for (t = 1; t < document.getElementById('actiontype').options.length; t += 1) {
        actiontypeval = document.getElementById('actiontype').options[t].value;
        actiontypetext = document.getElementById('actiontype').options[t].text;
        hasactiontype = document.querySelector(".action" + actiontypeval + "row");
        if (hasactiontype !== null) {
            actiontypebtn = '<label for="showaction' + actiontypeval + '" class="btn btn-sm btn-default"><input type="checkbox" name="showactiontype" id="showaction' + actiontypeval + '" class="actiontypebtn" value="' + actiontypeval + '" checked> ' + actiontypetext + '</label>';
        } else {
            actiontypebtn = '<label for="showaction' + actiontypeval + '" class="btn btn-sm btn-default"><input type="checkbox" name="showactiontype" id="showaction' + actiontypeval + '" class="actiontypebtn" value="' + actiontypeval + '" disabled> ' + actiontypetext + '</label>';
        }
        $("#actiontypebtns").append(actiontypebtn);
    }

    var filecasedomainval, filecasedomaintext, hasfiledomain, filecasedomainbtn;
    for (t = 1; t < document.getElementById('casefilecasedomain').options.length; t += 1) {
        filecasedomainval = document.getElementById('casefilecasedomain').options[t].value;
        filecasedomaintext = document.getElementById('casefilecasedomain').options[t].text;
        hasfiledomain = document.querySelector(".filecasedomain" + filecasedomainval + "table");
        if (hasfiledomain !== null) {
            filecasedomainbtn = '<label for="showfile' + filecasedomainval + '" class="btn btn-sm btn-default"><input type="checkbox" name="showfilecasedomain" id="showfile' + filecasedomainval + '" class="filecasedomainbtn" value="' + filecasedomainval + '" checked> ' + filecasedomaintext + '</label>';
        } else {
            filecasedomainbtn = '<label for="showfile' + filecasedomainval + '" class="btn btn-sm btn-default"><input type="checkbox" name="showfilecasedomain" id="showfile' + filecasedomainval + '" class="filecasedomainbtn" value="' + filecasedomainval + '" disabled> ' + filecasedomaintext + '</label>';
        }
        $("#filecasedomainbtns").append(filecasedomainbtn);
    }

    var notecasedomainval, notecasedomaintext, hasnotedomain, notecasedomainbtn;
    for (t = 1; t < document.getElementById('casenotecasedomain').options.length; t += 1) {
        notecasedomainval = document.getElementById('casenotecasedomain').options[t].value;
        notecasedomaintext = document.getElementById('casenotecasedomain').options[t].text;
        hasnotedomain = document.querySelector(".notecasedomain" + notecasedomainval + "table");
        if (hasnotedomain !== null) {
            notecasedomainbtn = '<label for="shownote' + notecasedomainval + '" class="btn btn-sm btn-default"><input type="checkbox" name="shownotecasedomain" id="shownote' + notecasedomainval + '" class="notecasedomainbtn" value="' + notecasedomainval + '" checked> ' + notecasedomaintext + '</label>';
        } else {
            notecasedomainbtn = '<label for="shownote' + notecasedomainval + '" class="btn btn-sm btn-default"><input type="checkbox" name="shownotecasedomain" id="shownote' + notecasedomainval + '" class="notecasedomainbtn" value="' + notecasedomainval + '" disabled> ' + notecasedomaintext + '</label>';
        }
        $("#notecasedomainbtns").append(notecasedomainbtn);
    }

    var c, btnid;
    var childrennavlink = document.querySelectorAll(".childrenanchorbtn");
    for (c = 0; c < childrennavlink.length; c += 1) {
        btnid = childrennavlink[c].id.slice(4);
        if (document.getElementById(btnid) === null) {
            childrennavlink[c].disabled = true;
        } else {
            childrennavlink[c].disabled = false;
        }
    }

    var b, numrows, briefhead;
    var goalsthruactionstable = document.querySelectorAll(".goalsthruactionstable");
    for (b = 0; b < goalsthruactionstable.length; b += 1) {
        numrows = document.getElementById("goalsthruactionstable" + b).getElementsByTagName("tbody")[0].getElementsByTagName("tr").length;
        if (numrows === 1) {
            briefhead = $("#briefhead" + b);
            briefhead.addClass("prog-start");
        }
    }

    for (i = 0; i < document.getElementById("casequeststatus").length; i += 1) {
        if (i !== 1) {
            document.getElementById("casequeststatus").options[i].style.display = "none";
        } else {
            document.getElementById("casequeststatus").options[i].style.display = "block";
        }
    }

    for (i = 1; i < document.getElementById("questassocwithname").length; i += 1) {
        document.getElementById("questassocwithname").options[i].style.display = "none";
    }
})();

</script>


<% include ../partials/footer2 %>