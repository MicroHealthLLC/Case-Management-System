<% include ../partials/header1 %>

<div id="cmscontent" class="container">

<div id="taskfiltersection">

	<h5><button id="tasksfilterbtn" class="btn btn-default btn-md filterbtn"><span class="glyphicon glyphicon-filter" aria-hidden="true"></span></button> Task Filter</h5>

	<form id="tasksfilterform" class="filterform" action="/tasks" method="POST">
	<div class="row">
		<div class="col-xs-12">
			<div class="form-group">
				<label for="taskfilterselecttask">Tasks</label>
				<select class="form-control" id="taskfilterselecttask" name="taskfilterselecttask">
					<option value="0">All</option>
					<option value="1" selected>My Tasks</option>
				</select>
			</div>
		</div>
	</div><!-- row -->
	<div class="row">
		<div class="col-xs-6 col-sm-3">
			<div class="form-group">
				<label for="taskfilterfromstartdate">From Start Date</label>
				<input type="text" class="form-control" id="taskfilterfromstartdate" name="taskfilterfromstartdate" value=""/>
			</div>
		</div>
		<div class="col-xs-6 col-sm-3">
			<div class="form-group">
				<label for="taskfiltertostartdate">To Start Date</label>
				<input type="text" class="form-control" id="taskfiltertostartdate" name="taskfiltertostartdate" value=""/>
			</div>
		</div>
		<div class="col-xs-6 col-sm-3">
			<div class="form-group">
				<label for="taskfilterfromduedate">From Due Date</label>
				<input type="text" class="form-control" id="taskfilterfromduedate" name="taskfilterfromduedate" value=""/>
			</div>
		</div>
		<div class="col-xs-6 col-sm-3">
			<div class="form-group">
				<label for="taskfiltertoduedate">To Due Date</label>
				<input type="text" class="form-control" id="taskfiltertoduedate" name="taskfiltertoduedate" value=""/>
			</div>
		</div>
	</div><!-- row -->
	<div class="buttonrow">
		<button type="reset" class="btn btn-md btn-warning" id="resettasksfilter">Reset</button>
		<button type="submit" class="btn btn-md btn-warning submitfilterbtn" id="submittasksfilter">Submit</button>
	</div>
	</form>

	</div><!-- taskfiltersection -->

	<br>

<div id="navbtns" class="buttonrow creatediv_multi">
	<p>
		<a href="/case" class="btn btn-primary btn-md" id="createcasebtn">Create Case</a>
		<a href="/person" class="btn btn-primary btn-md createbtn" id="createpersonbtn">Create Person</a>
		<a href="/organization" class="btn btn-primary btn-md createbtn" id="createorganizationbtn">Create Organization</a>
	</p>
</div>

		<h4><button id="plustask" class="btn btn-default btn-md plusbtn"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button> Task</h4>

		<form id="taskform" class="toggleform" action="/task" method="POST">
			<div class="row">
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="tasksubject">Subject</label>
						<input type="text" class="form-control" id="tasksubject" name="tasksubject" size="90" maxlength="100" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="tasktype">Type</label>
						<select class="form-control" id="tasktype" name="tasktype">
							<option value="0" selected>Select</option>
							<option value="1">Email</option>
							<option value="2">Call</option>
							<option value="3">Meeting</option>
							<option value="4">Referral</option>
							<option value="5">Research</option>
							<option value="6">Other</option>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="taskpriority">Priority</label>
						<select class="form-control" id="taskpriority" name="taskpriority">
							<option value="0" selected>Select</option>
							<option value="1">High</option>
							<option value="2">Medium</option>
							<option value="3">Low</option>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="taskstartdate">Start Date</label>
						<input type="text" class="form-control" id="taskstartdate" name="taskstartdate" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="taskduedate">Due Date</label>
						<input type="text" class="form-control" id="taskduedate" name="taskduedate" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="taskcompletedate">Complete Date</label>
						<input type="text" class="form-control" id="taskcompletedate" name="taskcompletedate" value=""/>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="taskassignedperson">Assigned To</label>
						<select class="form-control" id="taskassignedperson" name="taskassignedperson">
							<option value="0" selected>Select</option>
							<% person.sort(function(a,b) {
				                return (a.id > b.id) ? 1 : ((b.id > a.id) ? -1 : 0);
			                }); %>
							<% for (var i = 0; i < person.length; i += 1) { %>
							<option value="<%= person[i].person_id %>"><%= person[i].last_name %>, <%= person[i].first_name %> <%= person[i].middle_name %></option>
                            <% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="taskcaseid">Case Title</label>
						<select class="form-control" id="taskcaseid" name="taskcaseid">
							<option value="0" selected>Select</option>
							<% cases.sort(function(a,b) {
				                return (a.id > b.id) ? 1 : ((b.id > a.id) ? -1 : 0);
			                }); %>
							<% for (var i = 0; i < cases.length; i += 1) { %>
							<option value="<%= cases[i].case_id %>"><%= cases[i].case_title %></option>
                            <% } %>
						</select>
					</div>
				</div>
				<div class="col-xs-6 col-sm-4">
					<div class="form-group">
						<label for="taskstatus">Status</label>
						<select class="form-control" id="taskstatus" name="taskstatus">
							<option value="0" selected>Select</option>
							<option value="1">Not Started</option>
							<option value="2">In Progress</option>
							<option value="3">Pending Input</option>
							<option value="4">Completed</option>
							<option value="5">Overdue</option>
							<option value="6">Canceled</option>
						</select>
					</div>
				</div>
				<div class="col-xs-12">
					<div class="form-group">
						<label for="tasknote">Note</label>
						<textarea class="form-control" id="tasknote" name="tasknote"></textarea>
					</div>
				</div>
			</div><!-- row -->
			<div class="buttonrow">
				<button type="reset" class="btn btn-warning btn-md resetbtn" id="resettask" name="resettask">Reset</button>
				<button type="submit" class="btn btn-warning btn-md submitbtn" id="submittask" name="submittask">Submit</button>
			</div>
		</form>


		<table id="tasksdisplaytable" class="table table-responsive table-striped table-condensed 2rowremovebtntop">
			<thead>
				<tr class="info">
					<th>Task Subject</th>
					<th>Type</th>
					<th>Priority</th>
					<th>Due Date</th>
					<th>Assigned To</th>
					<th>Case Title</th>
					<th>Status</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
			<% taskslisting.sort(function(a,b) {
			    return (a.id > b.id) ? 1 : ((b.id > a.id) ? -1 : 0);
			}); %>
            <% for (var i = 0; i < taskslisting.length; i += 1) {
				var tsubject = "tsubject" + i;
				var ttype = "ttype" + i;
				var tpriority = "tpriority" + i;
				var tstart = "tstart" + i;
				var tdue = "tdue" + i;
				var tcomplete = "tcomplete" + i;
				var tpersonid = "tpersonid" + i;
				var tcaseid = "tcaseid" + i;
				var tstatus = "tstatus" + i;
				var tnote = "tnote" + i;
				var task = "task" + i;
				var edittask = "edittask" + i;
				var removetask = "removetask" + i;
			%>
				<tr>
					<td id="<%= tsubject %>"><%= taskslisting[i].subject %></td>
					<td id="<%= ttype %>"><%= taskslisting[i].type %></td>
					<td id="<%= tpriority %>"><%= taskslisting[i].priority %></td>
					<td id="<%= tdue %>"><%= taskslisting[i].due_date %></td>
					<td><span hidden id="<%= tpersonid %>"><%= taskslisting[i].person_id %></span><a href="/person/<%= taskslisting[i].person_id %>"><%= taskslisting[i].person_name %></a></td>
					<td><span hidden id="<%= tcaseid %>"><%= taskslisting[i].case_id %></span><a href="/case/<%= taskslisting[i].case_id %>"><%= taskslisting[i].case_title %></a></td>
					<td id="<%= tstatus %>"><%= taskslisting[i].status %></td>
					<td class="tablebtns" id="<%= taskslisting[i].task_id %>">
						<button class="btn btn-primary btn-md tableeditbtn taskeditbtn" id="<%= edittask %>"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></button>
						<button class="btn btn-default morebtn" type="button" data-toggle="collapse" data-target="#<%= task %>" aria-expanded="false" aria-controls="<%= task %>"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span></button>
                        <button class="btn btn-danger btn-md tableremovebtn" id="<%= removetask %>"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
					</td>
				</tr>
				<tr>
					<td colspan="8">						
						<div class="collapse" id="<%= task %>">
							<p><strong>Start Date:</strong> <span id="<%= tstart %>"><%= taskslisting[i].start_date %></span> &nbsp;&nbsp; 
							<strong>Complete Date:</strong> <span id="<%= tcomplete %>"><%= taskslisting[i].complete_date %></span>
							</p>
							<p><strong>Note:</strong> <span id="<%= tnote %>"><%= taskslisting[i].note %></span></p>
						</div>
					</td>
				</tr>
		      </tr>
			<% } %>
			</tbody>
		</table>

		<div id="taskspagination" class="paginationdiv">
			<nav aria-label="Page navigation">
			  <ul class="pagination">
			    <li class="disabled">
			      <a href="#" aria-label="Previous">
			        <span aria-hidden="true">&laquo;</span>
			      </a>
			    </li>
			    <li class="active"><a href="#">1</a></li>
			    <li><a href="#">2</a></li>
			    <li><a href="#">3</a></li>
			    <li>
			      <a href="#" aria-label="Next">
			        <span aria-hidden="true">&raquo;</span>
			      </a>
			    </li>
			  </ul>
			</nav>
		</div><!-- taskspagination -->


<h6>Overdue Tasks (<span id="overduetasks"><%= overdue_tasks.length %></span>)</h6>

	<% if (overdue_tasks.length > 0) { %>
		<table id="overduetaskdisplaytable" class="table table-responsive table-striped table-condensed">

			<thead>
				<tr class="info">
					<th>Task Subject</th>
					<th>Type</th>
					<th>Priority</th>
					<th>Due Date</th>
					<th>Assigned To</th>
					<th>Case Title</th>
					<th>Status</th>
				</tr>
			</thead>
			<tbody>
			<% overdue_tasks.sort(function(a,b) {
				return (a.id > b.id) ? 1 : ((b.id > a.id) ? -1 : 0);
			}); %>
			<% for (var i = 0; i < overdue_tasks.length; i += 1) { %>
				<tr>
					<td><%= overdue_tasks[i].subject %></td>
					<td><%= overdue_tasks[i].type %></td>
					<td><%= overdue_tasks[i].priority %></td>
					<td><%= overdue_tasks[i].due_date %></td>
					<td><a href="/person/<%= overdue_tasks[i].person_id %>"><%= overdue_tasks[i].person_id %></a></td>
					<td><a href="/case/<%= overdue_tasks[i].case_id %>"><%= overdue_tasks[i].case_id %></a></td>
					<td><%= overdue_tasks[i].status %></td>
				</tr>
			<% } %>
			</tbody>
		</table>
	<% } %>


</div><!-- cmscontent container -->


<% include ../partials/footer1 %>
